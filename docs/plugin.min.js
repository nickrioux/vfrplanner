const e={name:"windy-plugin-vfr-planner",version:"0.1.0",icon:"✈️",title:"VFR Flight Planner",description:"VFR flight planning with ForeFlight import support",author:"Nicolas",repository:"https://github.com/nrioux/windy-plugin-vfr-planner",desktopUI:"rhpane",mobileUI:"fullscreen",desktopWidth:400,routerPath:"/vfr-planner",private:!0,addToContextmenu:!0,listenToSingleclick:!0,built:1768351950953,builtReadable:"2026-01-14T00:52:30.953Z",screenshot:"screenshot.jpg"},t=W.broadcast,{map:n}=W.map,{singleclick:o}=W.singleclick,i=W.store,{getPointForecastData:s,getMeteogramForecastData:r}=W.fetch;function a(){}function l(e){return e()}function c(){return Object.create(null)}function d(e){e.forEach(l)}function u(e){return"function"==typeof e}function p(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}const g="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function f(e,t){e.appendChild(t)}function h(e,t,n){const o=function(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;if(t&&t.host)return t;return e.ownerDocument}(e);if(!o.getElementById(t)){const e=b("style");e.id=t,e.textContent=n,function(e,t){f(e.head||e,t),t.sheet}(o,e)}}function v(e,t,n){e.insertBefore(t,n||null)}function m(e){e.parentNode&&e.parentNode.removeChild(e)}function w(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function b(e){return document.createElement(e)}function y(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function x(e){return document.createTextNode(e)}function $(){return x(" ")}function z(){return x("")}function M(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function F(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function N(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function k(e){return""===e?null:+e}function P(e,t){t=""+t,e.data!==t&&(e.data=t)}function S(e,t){e.value=null==t?"":t}function A(e,t,n,o){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,"")}function D(e,t,n){e.classList.toggle(t,!!n)}let E;function T(e){E=e}function I(){if(!E)throw new Error("Function called outside component initialization");return E}function C(){const e=I();return(t,n,{cancelable:o=!1}={})=>{const i=e.$$.callbacks[t];if(i){const s=function(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}(t,n,{cancelable:o});return i.slice().forEach(t=>{t.call(e,s)}),!s.defaultPrevented}return!0}}const R=[],V=[];let O=[];const B=[],_=Promise.resolve();let j=!1;function G(){j||(j=!0,_.then(Y))}function U(){return G(),_}function q(e){O.push(e)}const X=new Set;let H=0;function Y(){if(0!==H)return;const e=E;do{try{for(;H<R.length;){const e=R[H];H++,T(e),Z(e.$$)}}catch(e){throw R.length=0,H=0,e}for(T(null),R.length=0,H=0;V.length;)V.pop()();for(let e=0;e<O.length;e+=1){const t=O[e];X.has(t)||(X.add(t),t())}O.length=0}while(R.length);for(;B.length;)B.pop()();j=!1,X.clear(),T(e)}function Z(e){if(null!==e.fragment){e.update(),d(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(q)}}const J=new Set;let K;function Q(){K={r:0,c:[],p:K}}function ee(){K.r||d(K.c),K=K.p}function te(e,t){e&&e.i&&(J.delete(e),e.i(t))}function ne(e,t,n,o){if(e&&e.o){if(J.has(e))return;J.add(e),K.c.push(()=>{J.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function oe(e){return void 0!==e?.length?e:Array.from(e)}function ie(e,t){e.d(1),t.delete(e.key)}function se(e,t,n){const{fragment:o,after_update:i}=e.$$;o&&o.m(t,n),q(()=>{const t=e.$$.on_mount.map(l).filter(u);e.$$.on_destroy?e.$$.on_destroy.push(...t):d(t),e.$$.on_mount=[]}),i.forEach(q)}function re(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];O.forEach(o=>-1===e.indexOf(o)?t.push(o):n.push(o)),n.forEach(e=>e()),O=t}(n.after_update),d(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ae(e,t,n,o,i,s,r=null,l=[-1]){const u=E;T(e);const p=e.$$={fragment:null,ctx:[],props:s,update:a,not_equal:i,bound:c(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:c(),dirty:l,skip_bound:!1,root:t.target||u.$$.root};r&&r(p.root);let g=!1;if(p.ctx=n?n(e,t.props||{},(t,n,...o)=>{const s=o.length?o[0]:n;return p.ctx&&i(p.ctx[t],p.ctx[t]=s)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](s),g&&function(e,t){-1===e.$$.dirty[0]&&(R.push(e),G(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n}):[],p.update(),g=!0,d(p.before_update),p.fragment=!!o&&o(p.ctx),t.target){if(t.hydrate){const e=function(e){return Array.from(e.childNodes)}(t.target);p.fragment&&p.fragment.l(e),e.forEach(m)}else p.fragment&&p.fragment.c();t.intro&&te(e.$$.fragment),se(e,t.target,t.anchor),Y()}T(u)}class le{$$=void 0;$$set=void 0;$destroy(){re(this,1),this.$destroy=a}$on(e,t){if(!u(t))return a;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const ce={name:"windy-plugin-vfr-planner",title:"VFR Flight Planner"};var de={},ue={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+t+"]["+(t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",o=new RegExp("^"+n+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,n){if(t){const o=Object.keys(t),i=o.length;for(let s=0;s<i;s++)e[o[s]]="strict"===n?[t[o[s]]]:t[o[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=o.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const n=[];let o=t.exec(e);for(;o;){const i=[];i.startIndex=t.lastIndex-o[0].length;const s=o.length;for(let e=0;e<s;e++)i.push(o[e]);n.push(i),o=t.exec(e)}return n},e.nameRegexp=n}(ue);const pe=ue,ge={allowBooleanAttributes:!1,unpairedTags:[]};function fe(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function he(e,t){const n=t;for(;t<e.length;t++)if("?"==e[t]||" "==e[t]){const o=e.substr(n,t-n);if(t>5&&"xml"===o)return ze("InvalidXml","XML declaration allowed only at the start of the document.",Ne(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}continue}return t}function ve(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}de.validate=function(e,t){t=Object.assign({},ge,t);const n=[];let o=!1,i=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=he(e,s),s.err)return s}else{if("<"!==e[s]){if(fe(e[s]))continue;return ze("InvalidChar","char '"+e[s]+"' is not expected.",Ne(e,s))}{let r=s;if(s++,"!"===e[s]){s=ve(e,s);continue}{let a=!1;"/"===e[s]&&(a=!0,s++);let l="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)l+=e[s];if(l=l.trim(),"/"===l[l.length-1]&&(l=l.substring(0,l.length-1),s--),!Fe(l)){let t;return t=0===l.trim().length?"Invalid space after '<'.":"Tag '"+l+"' is an invalid name.",ze("InvalidTag",t,Ne(e,s))}const c=be(e,s);if(!1===c)return ze("InvalidAttr","Attributes for '"+l+"' have open quote.",Ne(e,s));let d=c.value;if(s=c.index,"/"===d[d.length-1]){const n=s-d.length;d=d.substring(0,d.length-1);const i=xe(d,t);if(!0!==i)return ze(i.err.code,i.err.msg,Ne(e,n+i.err.line));o=!0}else if(a){if(!c.tagClosed)return ze("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",Ne(e,s));if(d.trim().length>0)return ze("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",Ne(e,r));if(0===n.length)return ze("InvalidTag","Closing tag '"+l+"' has not been opened.",Ne(e,r));{const t=n.pop();if(l!==t.tagName){let n=Ne(e,t.tagStartPos);return ze("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+l+"'.",Ne(e,r))}0==n.length&&(i=!0)}}else{const a=xe(d,t);if(!0!==a)return ze(a.err.code,a.err.msg,Ne(e,s-d.length+a.err.line));if(!0===i)return ze("InvalidXml","Multiple possible root nodes found.",Ne(e,s));-1!==t.unpairedTags.indexOf(l)||n.push({tagName:l,tagStartPos:r}),o=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=ve(e,s);continue}if("?"!==e[s+1])break;if(s=he(e,++s),s.err)return s}else if("&"===e[s]){const t=$e(e,s);if(-1==t)return ze("InvalidChar","char '&' is not expected.",Ne(e,s));s=t}else if(!0===i&&!fe(e[s]))return ze("InvalidXml","Extra text at the end",Ne(e,s));"<"===e[s]&&s--}}}return o?1==n.length?ze("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",Ne(e,n[0].tagStartPos)):!(n.length>0)||ze("InvalidXml","Invalid '"+JSON.stringify(n.map(e=>e.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):ze("InvalidXml","Start tag expected.",1)};const me='"',we="'";function be(e,t){let n="",o="",i=!1;for(;t<e.length;t++){if(e[t]===me||e[t]===we)""===o?o=e[t]:o!==e[t]||(o="");else if(">"===e[t]&&""===o){i=!0;break}n+=e[t]}return""===o&&{value:n,index:t,tagClosed:i}}const ye=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function xe(e,t){const n=pe.getAllMatches(e,ye),o={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return ze("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",ke(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return ze("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",ke(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return ze("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",ke(n[e]));const i=n[e][2];if(!Me(i))return ze("InvalidAttr","Attribute '"+i+"' is an invalid name.",ke(n[e]));if(o.hasOwnProperty(i))return ze("InvalidAttr","Attribute '"+i+"' is repeated.",ke(n[e]));o[i]=1}return!0}function $e(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function ze(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function Me(e){return pe.isName(e)}function Fe(e){return pe.isName(e)}function Ne(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function ke(e){return e.startIndex+e[1].length}var Pe={};const Se={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e}};Pe.buildOptions=function(e){return Object.assign({},Se,e)},Pe.defaultOptions=Se;const Ae=ue;function De(e,t){let n="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)n+=e[t];if(n=n.trim(),-1!==n.indexOf(" "))throw new Error("External entites are not supported");const o=e[t++];let i="";for(;t<e.length&&e[t]!==o;t++)i+=e[t];return[n,i,t]}function Ee(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function Te(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function Ie(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function Ce(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function Re(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function Le(e){if(Ae.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}const Ve=/^[-+]?0x[a-fA-F0-9]+$/,Oe=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,We={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};var Be=function(e){return"function"==typeof e?e:Array.isArray(e)?t=>{for(const n of e){if("string"==typeof n&&t===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}}:()=>!1};const _e=ue,je=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}},Ge=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let o=1,i=!1,s=!1,r="";for(;t<e.length;t++)if("<"!==e[t]||s)if(">"===e[t]){if(s?"-"===e[t-1]&&"-"===e[t-2]&&(s=!1,o--):o--,0===o)break}else"["===e[t]?i=!0:r+=e[t];else{if(i&&Te(e,t)){let o,i;t+=7,[o,i,t]=De(e,t+1),-1===i.indexOf("&")&&(n[Le(o)]={regx:RegExp(`&${o};`,"g"),val:i})}else if(i&&Ie(e,t))t+=8;else if(i&&Ce(e,t))t+=8;else if(i&&Re(e,t))t+=9;else{if(!Ee)throw new Error("Invalid DOCTYPE");s=!0}o++,r=""}if(0!==o)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}},Ue=function(e,t={}){if(t=Object.assign({},We,t),!e||"string"!=typeof e)return e;let n=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(n))return e;if("0"===e)return 0;if(t.hex&&Ve.test(n))return function(e,t){if(parseInt)return parseInt(e,t);if(Number.parseInt)return Number.parseInt(e,t);if(window&&window.parseInt)return window.parseInt(e,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(n,16);if(-1!==n.search(/[eE]/)){const o=n.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(o){if(t.leadingZeros)n=(o[1]||"")+o[3];else if("0"!==o[2]||"."!==o[3][0])return e;return t.eNotation?Number(n):e}return e}{const o=Oe.exec(n);if(o){const i=o[1],s=o[2];let r=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(o[3]);if(!t.leadingZeros&&s.length>0&&i&&"."!==n[2])return e;if(!t.leadingZeros&&s.length>0&&!i&&"."!==n[1])return e;if(t.leadingZeros&&s===e)return 0;{const o=Number(n),a=""+o;return-1!==a.search(/[eE]/)?t.eNotation?o:e:-1!==n.indexOf(".")?"0"===a&&""===r||a===r||i&&a==="-"+r?o:e:s?r===a||i+r===a?o:e:n===a||n===i+a?o:e}}return e}},qe=Be;function Xe(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const o=t[n];this.lastEntities[o]={regex:new RegExp("&"+o+";","g"),val:e[o]}}}function He(e,t,n,o,i,s,r){if(void 0!==e&&(this.options.trimValues&&!o&&(e=e.trim()),e.length>0)){r||(e=this.replaceEntitiesValue(e));const o=this.options.tagValueProcessor(t,e,n,i,s);if(null==o)return e;if(typeof o!=typeof e||o!==e)return o;if(this.options.trimValues)return rt(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?rt(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Ye(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const Ze=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function Je(e,t,n){if(!0!==this.options.ignoreAttributes&&"string"==typeof e){const n=_e.getAllMatches(e,Ze),o=n.length,i={};for(let e=0;e<o;e++){const o=this.resolveNameSpace(n[e][1]);if(this.ignoreAttributesFn(o,t))continue;let s=n[e][4],r=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(r=this.options.transformAttributeName(r)),"__proto__"===r&&(r="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(o,s,t);i[r]=null==e?s:typeof e!=typeof s||e!==s?e:rt(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[r]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const Ke=function(e){e=e.replace(/\r\n?/g,"\n");const t=new je("!xml");let n=t,o="",i="";for(let s=0;s<e.length;s++){if("<"===e[s])if("/"===e[s+1]){const t=ot(e,">",s,"Closing Tag is not closed.");let r=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=r.indexOf(":");-1!==e&&(r=r.substr(e+1))}this.options.transformTagName&&(r=this.options.transformTagName(r)),n&&(o=this.saveTextToParentTag(o,n,i));const a=i.substring(i.lastIndexOf(".")+1);if(r&&-1!==this.options.unpairedTags.indexOf(r))throw new Error(`Unpaired tag can not be used as closing tag: </${r}>`);let l=0;a&&-1!==this.options.unpairedTags.indexOf(a)?(l=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=i.lastIndexOf("."),i=i.substring(0,l),n=this.tagsNodeStack.pop(),o="",s=t}else if("?"===e[s+1]){let t=it(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(o=this.saveTextToParentTag(o,n,i),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new je(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,i,t.tagName)),this.addChild(n,e,i)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=ot(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const r=e.substring(s+4,t-2);o=this.saveTextToParentTag(o,n,i),n.add(this.options.commentPropName,[{[this.options.textNodeName]:r}])}s=t}else if("!D"===e.substr(s+1,2)){const t=Ge(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=ot(e,"]]>",s,"CDATA is not closed.")-2,r=e.substring(s+9,t);o=this.saveTextToParentTag(o,n,i);let a=this.parseTextData(r,n.tagname,i,!0,!1,!0,!0);null==a&&(a=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:r}]):n.add(this.options.textNodeName,a),s=t+2}else{let r=it(e,s,this.options.removeNSPrefix),a=r.tagName;const l=r.rawTagName;let c=r.tagExp,d=r.attrExpPresent,u=r.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),n&&o&&"!xml"!==n.tagname&&(o=this.saveTextToParentTag(o,n,i,!1));const p=n;if(p&&-1!==this.options.unpairedTags.indexOf(p.tagname)&&(n=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),a!==t.tagname&&(i+=i?"."+a:a),this.isItStopNode(this.options.stopNodes,i,a)){let t="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)"/"===a[a.length-1]?(a=a.substr(0,a.length-1),i=i.substr(0,i.length-1),c=a):c=c.substr(0,c.length-1),s=r.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(a))s=r.closeIndex;else{const n=this.readStopNodeData(e,l,u+1);if(!n)throw new Error(`Unexpected end of ${l}`);s=n.i,t=n.tagContent}const o=new je(a);a!==c&&d&&(o[":@"]=this.buildAttributesMap(c,i,a)),t&&(t=this.parseTextData(t,a,i,!0,d,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),o.add(this.options.textNodeName,t),this.addChild(n,o,i)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),i=i.substr(0,i.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const e=new je(a);a!==c&&d&&(e[":@"]=this.buildAttributesMap(c,i,a)),this.addChild(n,e,i),i=i.substr(0,i.lastIndexOf("."))}else{const e=new je(a);this.tagsNodeStack.push(n),a!==c&&d&&(e[":@"]=this.buildAttributesMap(c,i,a)),this.addChild(n,e,i),n=e}o="",s=u}}else o+=e[s]}return t.child};function Qe(e,t,n){const o=this.options.updateTag(t.tagname,n,t[":@"]);!1===o||("string"==typeof o?(t.tagname=o,e.addChild(t)):e.addChild(t))}const et=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function tt(e,t,n,o){return e&&(void 0===o&&(o=0===t.child.length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,o))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function nt(e,t,n){const o="*."+n;for(const n in e){const i=e[n];if(o===i||t===i)return!0}return!1}function ot(e,t,n,o){const i=e.indexOf(t,n);if(-1===i)throw new Error(o);return i+t.length-1}function it(e,t,n,o=">"){const i=function(e,t,n=">"){let o,i="";for(let s=t;s<e.length;s++){let t=e[s];if(o)t===o&&(o="");else if('"'===t||"'"===t)o=t;else if(t===n[0]){if(!n[1])return{data:i,index:s};if(e[s+1]===n[1])return{data:i,index:s}}else"\t"===t&&(t=" ");i+=t}}(e,t+1,o);if(!i)return;let s=i.data;const r=i.index,a=s.search(/\s/);let l=s,c=!0;-1!==a&&(l=s.substring(0,a),s=s.substring(a+1).trimStart());const d=l;if(n){const e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),c=l!==i.data.substr(e+1))}return{tagName:l,tagExp:s,closeIndex:r,attrExpPresent:c,rawTagName:d}}function st(e,t,n){const o=n;let i=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const s=ot(e,">",n,`${t} is not closed`);if(e.substring(n+2,s).trim()===t&&(i--,0===i))return{tagContent:e.substring(o,n),i:s};n=s}else if("?"===e[n+1]){n=ot(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=ot(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=ot(e,"]]>",n,"StopNode is not closed.")-2}else{const o=it(e,n,">");if(o){(o&&o.tagName)===t&&"/"!==o.tagExp[o.tagExp.length-1]&&i++,n=o.closeIndex}}}function rt(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&Ue(e,n)}return _e.isExist(e)?e:""}var at=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=Xe,this.parseXml=Ke,this.parseTextData=He,this.resolveNameSpace=Ye,this.buildAttributesMap=Je,this.isItStopNode=nt,this.replaceEntitiesValue=et,this.readStopNodeData=st,this.saveTextToParentTag=tt,this.addChild=Qe,this.ignoreAttributesFn=qe(this.options.ignoreAttributes)}},lt={};function ct(e,t,n){let o;const i={};for(let s=0;s<e.length;s++){const r=e[s],a=dt(r);let l="";if(l=void 0===n?a:n+"."+a,a===t.textNodeName)void 0===o?o=r[a]:o+=""+r[a];else{if(void 0===a)continue;if(r[a]){let e=ct(r[a],t,l);const n=pt(e,t);r[":@"]?ut(e,r[":@"],l,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==i[a]&&i.hasOwnProperty(a)?(Array.isArray(i[a])||(i[a]=[i[a]]),i[a].push(e)):t.isArray(a,l,n)?i[a]=[e]:i[a]=e}}}return"string"==typeof o?o.length>0&&(i[t.textNodeName]=o):void 0!==o&&(i[t.textNodeName]=o),i}function dt(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function ut(e,t,n,o){if(t){const i=Object.keys(t),s=i.length;for(let r=0;r<s;r++){const s=i[r];o.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function pt(e,t){const{textNodeName:n}=t,o=Object.keys(e).length;return 0===o||!(1!==o||!e[n]&&"boolean"!=typeof e[n]&&0!==e[n])}lt.prettify=function(e,t){return ct(e,t)};const{buildOptions:gt}=Pe,ft=at,{prettify:ht}=lt,vt=de;var mt=class{constructor(e){this.externalEntities={},this.options=gt(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=vt.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new ft(this.options);n.addExternalEntities(this.externalEntities);const o=n.parseXml(e);return this.options.preserveOrder||void 0===o?o:ht(o,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};function wt(e,t,n,o){let i="",s=!1;for(let r=0;r<e.length;r++){const a=e[r],l=bt(a);if(void 0===l)continue;let c="";if(c=0===n.length?l:`${n}.${l}`,l===t.textNodeName){let e=a[l];xt(c,t)||(e=t.tagValueProcessor(l,e),e=$t(e,t)),s&&(i+=o),i+=e,s=!1;continue}if(l===t.cdataPropName){s&&(i+=o),i+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,s=!1;continue}if(l===t.commentPropName){i+=o+`\x3c!--${a[l][0][t.textNodeName]}--\x3e`,s=!0;continue}if("?"===l[0]){const e=yt(a[":@"],t),n="?xml"===l?"":o;let r=a[l][0][t.textNodeName];r=0!==r.length?" "+r:"",i+=n+`<${l}${r}${e}?>`,s=!0;continue}let d=o;""!==d&&(d+=t.indentBy);const u=o+`<${l}${yt(a[":@"],t)}`,p=wt(a[l],t,c,d);-1!==t.unpairedTags.indexOf(l)?t.suppressUnpairedNode?i+=u+">":i+=u+"/>":p&&0!==p.length||!t.suppressEmptyNode?p&&p.endsWith(">")?i+=u+`>${p}${o}</${l}>`:(i+=u+">",p&&""!==o&&(p.includes("/>")||p.includes("</"))?i+=o+t.indentBy+p+o:i+=p,i+=`</${l}>`):i+=u+"/>",s=!0}return i}function bt(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const o=t[n];if(e.hasOwnProperty(o)&&":@"!==o)return o}}function yt(e,t){let n="";if(e&&!t.ignoreAttributes)for(let o in e){if(!e.hasOwnProperty(o))continue;let i=t.attributeValueProcessor(o,e[o]);i=$t(i,t),!0===i&&t.suppressBooleanAttributes?n+=` ${o.substr(t.attributeNamePrefix.length)}`:n+=` ${o.substr(t.attributeNamePrefix.length)}="${i}"`}return n}function xt(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let o in t.stopNodes)if(t.stopNodes[o]===e||t.stopNodes[o]==="*."+n)return!0;return!1}function $t(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const o=t.entities[n];e=e.replace(o.regex,o.val)}return e}const zt=function(e,t){let n="";return t.format&&t.indentBy.length>0&&(n="\n"),wt(e,t,"",n)},Mt=Be,Ft={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Nt(e){this.options=Object.assign({},Ft,e),!0===this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=Mt(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=St),this.processTextOrObjNode=kt,this.options.format?(this.indentate=Pt,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function kt(e,t,n,o){const i=this.j2x(e,n+1,o.concat(t));return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,i.attrStr,n):this.buildObjectNode(i.val,t,i.attrStr,n)}function Pt(e){return this.options.indentBy.repeat(e)}function St(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}Nt.prototype.build=function(e){return this.options.preserveOrder?zt(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0,[]).val)},Nt.prototype.j2x=function(e,t,n){let o="",i="";const s=n.join(".");for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r))if(void 0===e[r])this.isAttribute(r)&&(i+="");else if(null===e[r])this.isAttribute(r)||r===this.options.cdataPropName?i+="":"?"===r[0]?i+=this.indentate(t)+"<"+r+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+r+"/"+this.tagEndChar;else if(e[r]instanceof Date)i+=this.buildTextValNode(e[r],r,"",t);else if("object"!=typeof e[r]){const n=this.isAttribute(r);if(n&&!this.ignoreAttributesFn(n,s))o+=this.buildAttrPairStr(n,""+e[r]);else if(!n)if(r===this.options.textNodeName){let t=this.options.tagValueProcessor(r,""+e[r]);i+=this.replaceEntitiesValue(t)}else i+=this.buildTextValNode(e[r],r,"",t)}else if(Array.isArray(e[r])){const o=e[r].length;let s="",a="";for(let l=0;l<o;l++){const o=e[r][l];if(void 0===o);else if(null===o)"?"===r[0]?i+=this.indentate(t)+"<"+r+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+r+"/"+this.tagEndChar;else if("object"==typeof o)if(this.options.oneListGroup){const e=this.j2x(o,t+1,n.concat(r));s+=e.val,this.options.attributesGroupName&&o.hasOwnProperty(this.options.attributesGroupName)&&(a+=e.attrStr)}else s+=this.processTextOrObjNode(o,r,t,n);else if(this.options.oneListGroup){let e=this.options.tagValueProcessor(r,o);e=this.replaceEntitiesValue(e),s+=e}else s+=this.buildTextValNode(o,r,"",t)}this.options.oneListGroup&&(s=this.buildObjectNode(s,r,a,t)),i+=s}else if(this.options.attributesGroupName&&r===this.options.attributesGroupName){const t=Object.keys(e[r]),n=t.length;for(let i=0;i<n;i++)o+=this.buildAttrPairStr(t[i],""+e[r][t[i]])}else i+=this.processTextOrObjNode(e[r],r,t,n);return{attrStr:o,val:i}},Nt.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},Nt.prototype.buildObjectNode=function(e,t,n,o){if(""===e)return"?"===t[0]?this.indentate(o)+"<"+t+n+"?"+this.tagEndChar:this.indentate(o)+"<"+t+n+this.closeTag(t)+this.tagEndChar;{let i="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",i=""),!n&&""!==n||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(o)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(o)+"<"+t+n+s+this.tagEndChar+e+this.indentate(o)+i:this.indentate(o)+"<"+t+n+s+">"+e+i}},Nt.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},Nt.prototype.buildTextValNode=function(e,t,n,o){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(o)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(o)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(o)+"<"+t+n+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),""===i?this.indentate(o)+"<"+t+n+this.closeTag(t)+this.tagEndChar:this.indentate(o)+"<"+t+n+">"+i+"</"+t+this.tagEndChar}},Nt.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e};const At=["AIRPORT","USER WAYPOINT","VOR","NDB","INT","INT-VRP"],Dt=new{XMLParser:mt,XMLValidator:de,XMLBuilder:Nt}.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"@_",parseAttributeValue:!0,trimValues:!0});function Et(e){const t=e.toUpperCase().trim();return At.includes(t)?t:"USER WAYPOINT"}function Tt(e){return{identifier:String(e.identifier||"").toUpperCase(),type:Et(String(e.type||"USER WAYPOINT")),countryCode:String(e["country-code"]||""),lat:Number(e.lat)||0,lon:Number(e.lon)||0,comment:e.comment?String(e.comment):void 0,elevation:void 0!==e.elevation?Number(e.elevation):void 0}}function It(e){const t=[];if(!e||!e.waypoint)return t;const n=Array.isArray(e.waypoint)?e.waypoint:[e.waypoint];for(const e of n)e&&"object"==typeof e&&t.push(Tt(e));return t}function Ct(e){return{waypointIdentifier:String(e["waypoint-identifier"]||"").toUpperCase(),waypointType:Et(String(e["waypoint-type"]||"USER WAYPOINT")),waypointCountryCode:String(e["waypoint-country-code"]||"")}}function Rt(e){if(!e)return;const t=[];if(e["route-point"]){const n=Array.isArray(e["route-point"])?e["route-point"]:[e["route-point"]];for(const e of n)e&&"object"==typeof e&&t.push(Ct(e))}return{name:String(e["route-name"]||"Unnamed Route"),description:e["route-description"]?String(e["route-description"]):void 0,flightPlanIndex:Number(e["flight-plan-index"])||1,points:t}}function Lt(e,t){return`${e}-${t}-${Date.now()}`}async function Vt(e){return new Promise(t=>{const n=new FileReader;n.onload=e=>{const n=e.target?.result;t("string"==typeof n?function(e){try{const t=Dt.parse(e)["flight-plan"];return t?t["waypoint-table"]?{success:!0,flightPlan:{created:t.created?new Date(t.created):void 0,waypointTable:It(t["waypoint-table"]),route:t.route?Rt(t.route):void 0}}:{success:!1,error:"Invalid FPL file: missing waypoint-table"}:{success:!1,error:"Invalid FPL file: missing flight-plan root element"}}catch(e){return{success:!1,error:`Failed to parse FPL file: ${e instanceof Error?e.message:"Unknown error"}`}}}(n):{success:!1,error:"Failed to read file content"})},n.onerror=()=>{t({success:!1,error:"Failed to read file"})},n.readAsText(e)})}var Ot=6371008.8,Wt={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*Ot,kilometers:6371.0088,kilometres:6371.0088,meters:Ot,metres:Ot,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:Ot/1852,radians:1,yards:6967335.223679999};function Bt(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!jt(e[0])||!jt(e[1]))throw new Error("coordinates must contain numbers");return function(e,t,n){void 0===n&&(n={});var o={type:"Feature"};return(0===n.id||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties={},o.geometry=e,o}({type:"Point",coordinates:e},0,n)}function _t(e){return e%360*Math.PI/180}function jt(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function Gt(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ut(e,t,n){void 0===n&&(n={});var o=Gt(e),i=Gt(t),s=_t(i[1]-o[1]),r=_t(i[0]-o[0]),a=_t(o[1]),l=_t(i[1]),c=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(r/2),2)*Math.cos(a)*Math.cos(l);return function(e,t){void 0===t&&(t="kilometers");var n=Wt[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}function qt(e,t,n){if(void 0===n&&(n={}),!0===n.final)return function(e,t){var n=qt(t,e);return n=(n+180)%360}(e,t);var o=Gt(e),i=Gt(t),s=_t(o[0]),r=_t(i[0]),a=_t(o[1]),l=_t(i[1]),c=Math.sin(r-s)*Math.cos(l),d=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(r-s);return Math.atan2(c,d)%(2*Math.PI)*180/Math.PI}function Xt(e,t,n,o){return(qt(Bt([t,e]),Bt([o,n]))+360)%360}function Ht(e,t,n,o){return Ut(Bt([t,e]),Bt([o,n]),{units:"nauticalmiles"})}function Yt(e,t,n){const o=e*Math.PI/180,i=t*Math.PI/180;return n*Math.cos(i-o)}function Zt(e,t,n,o){const i=e-Yt(t,n,o);return Math.max(0,i)}function Jt(e,t=100){if(0===e.length)return{waypoints:[],totals:{distance:0,ete:0}};let n=0,o=0,i=0;const s=e.map((s,r)=>{if(0===r)return{...s,distance:0,bearing:0,ete:0};const a=function(e,t,n=100,o,i){const s=Xt(e.lat,e.lon,t.lat,t.lon),r=Ht(e.lat,e.lon,t.lat,t.lon);let a,l;return void 0!==o&&void 0!==i?(a=Zt(n,s,o,i),l=a>0?r/a*60:void 0):(a=n,l=r/n*60),{distance:r,bearing:s,groundSpeed:a,ete:l}}(e[r-1],s,t,s.windDir,s.windSpeed);if(n+=a.distance,a.ete&&(o+=a.ete),void 0!==s.windDir&&void 0!==s.windSpeed&&void 0!==a.bearing){const e=Yt(a.bearing,s.windDir,s.windSpeed);i+=e*a.distance}return{...s,distance:a.distance,bearing:a.bearing,groundSpeed:a.groundSpeed,ete:a.ete}});return{waypoints:s,totals:{distance:n,ete:o,averageGroundSpeed:o>0?n/o*60:t,averageHeadwind:n>0?i/n:void 0}}}function Kt(e){return`${e.toFixed(1)} NM`}function Qt(e){return`${Math.round(e).toString().padStart(3,"0")}°`}function en(e){const t=Math.floor(e/60),n=Math.round(e%60);return t>0?`${t}h ${n.toString().padStart(2,"0")}m`:`${n}m`}function tn(e){const t=Math.abs(e);return e>0?`HW ${t.toFixed(0)} kt`:e<0?`TW ${t.toFixed(0)} kt`:"No wind"}function nn(e){const t=(new Date).toISOString(),n=e.waypoints.map(e=>function(e){const t=void 0!==e.elevation?`\n      <ele>${on(e.elevation).toFixed(1)}</ele>`:"",n=e.comment?`\n      <cmt>${sn(e.comment)}</cmt>`:"",o="USER WAYPOINT"!==e.type?`\n      <desc>${sn(e.type)}</desc>`:"";return`<wpt lat="${e.lat.toFixed(6)}" lon="${e.lon.toFixed(6)}">\n      <name>${sn(e.name)}</name>${t}${n}${o}\n      <sym>${function(e){switch(e){case"AIRPORT":return"Airport";case"VOR":return"Navaid, VOR";case"NDB":return"Navaid, NDB";case"INT":case"INT-VRP":return"Waypoint";default:return"Flag, Blue"}}(e.type)}</sym>\n    </wpt>`}(e)).join("\n    "),o=e.waypoints.map(e=>function(e){const t=void 0!==e.elevation?`\n        <ele>${on(e.elevation).toFixed(1)}</ele>`:"";return`<rtept lat="${e.lat.toFixed(6)}" lon="${e.lon.toFixed(6)}">\n        <name>${sn(e.name)}</name>${t}\n      </rtept>`}(e)).join("\n      ");return`<?xml version="1.0" encoding="UTF-8"?>\n<gpx version="1.1" creator="VFR Flight Planner - Windy Plugin"\n  xmlns="http://www.topografix.com/GPX/1/1"\n  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">\n  <metadata>\n    <name>${sn(e.name)}</name>\n    <time>${t}</time>\n  </metadata>\n\n  \x3c!-- Waypoints --\x3e\n  ${n}\n\n  \x3c!-- Route --\x3e\n  <rte>\n    <name>${sn(e.name)}</name>\n    ${o}\n  </rte>\n</gpx>`}function on(e){return.3048*e}function sn(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const rn={windSpeed:25,gustSpeed:35,visibility:5,cloudBase:1500,precipitation:5};function an(e){return 1.94384*e}function ln(e){return e-273.15}function cn(e){return 3.28084*e}const dn=[{level:"surface",altitudeFeet:0},{level:"1000h",altitudeFeet:330},{level:"950h",altitudeFeet:1600},{level:"900h",altitudeFeet:3300},{level:"850h",altitudeFeet:5e3},{level:"700h",altitudeFeet:1e4},{level:"500h",altitudeFeet:18e3},{level:"300h",altitudeFeet:3e4},{level:"200h",altitudeFeet:39e3}];const un=[{level:"1000h",altitudeFeet:330},{level:"975h",altitudeFeet:1e3},{level:"950h",altitudeFeet:1600},{level:"925h",altitudeFeet:2500},{level:"900h",altitudeFeet:3300},{level:"850h",altitudeFeet:5e3},{level:"800h",altitudeFeet:6200},{level:"700h",altitudeFeet:1e4},{level:"600h",altitudeFeet:14e3},{level:"500h",altitudeFeet:18e3},{level:"400h",altitudeFeet:23500},{level:"300h",altitudeFeet:3e4},{level:"250h",altitudeFeet:34e3},{level:"200h",altitudeFeet:39e3},{level:"150h",altitudeFeet:45e3},{level:"100h",altitudeFeet:53e3}];function pn(e,t=0,n=!1){if(!e)return[];const o=[],i=Object.keys(e);if(n){console.log(`[VFR Debug] getAllWindLevels - total keys: ${i.length}`);const e=i.filter(e=>e.toLowerCase().includes("wind"));console.log("[VFR Debug] Wind-related keys:",e)}const s=function(e,t=!1){const n=Object.keys(e),o=new Map,i=new Map,s=new Map;for(const e of n){let t=e.match(/wind.*[uU][-_]?(\d+h?)/i);if(t){const n=t[1].endsWith("h")?t[1]:`${t[1]}h`;i.set(n,e);continue}if(t=e.match(/wind.*[vV][-_]?(\d+h?)/i),t){const n=t[1].endsWith("h")?t[1]:`${t[1]}h`;s.set(n,e)}}t&&(console.log("[VFR Debug] Found U keys:",Array.from(i.entries())),console.log("[VFR Debug] Found V keys:",Array.from(s.entries())));for(const[e,t]of i){const n=s.get(e);n&&o.set(e,{uKey:t,vKey:n})}return o}(e,n);if(s.size>0){n&&console.log(`[VFR Debug] Using dynamic key discovery, found ${s.size} level pairs`);for(const[i,{uKey:r,vKey:a}]of s){const s=e[r],l=e[a];if(Array.isArray(s)&&Array.isArray(l)&&s.length>t&&l.length>t){const e=s[t],c=l[t];if("number"==typeof e&&"number"==typeof c){const t=un.find(e=>e.level===i);if(!t){n&&console.log(`[VFR Debug] Skipping unknown level: ${i}`);continue}const s=1.94384*Math.sqrt(e*e+c*c),l=(180*Math.atan2(-e,-c)/Math.PI+360)%360;o.push({level:i,altitudeFeet:t.altitudeFeet,windSpeed:s,windDir:l}),n&&console.log(`[VFR Debug] Level ${i} (${t.altitudeFeet}ft): ${r}=${e}, ${a}=${c} -> ${Math.round(l)}°/${Math.round(s)}kt`)}}}}if(0===o.length){n&&console.log("[VFR Debug] Dynamic discovery found no winds, trying predefined formats...");for(const i of un){const s=[`windU-${i.level}`,`wind_u-${i.level}`,`wind-u-${i.level}`,`windU_${i.level}`,`wind_u_${i.level}`],r=[`windV-${i.level}`,`wind_v-${i.level}`,`wind-v-${i.level}`,`windV_${i.level}`,`wind_v_${i.level}`];let a,l,c="",d="";for(const n of s)if(void 0!==e[n]){const o=e[n];a=Array.isArray(o)?o[t]:o,c=n;break}for(const n of r)if(void 0!==e[n]){const o=e[n];l=Array.isArray(o)?o[t]:o,d=n;break}if(n&&"850h"===i.level&&console.log(`[VFR Debug] Predefined lookup for ${i.level}: foundU=${c}(${a}), foundV=${d}(${l})`),"number"==typeof a&&"number"==typeof l){const e=1.94384*Math.sqrt(a*a+l*l),t=(180*Math.atan2(-a,-l)/Math.PI+360)%360;o.push({level:i.level,altitudeFeet:i.altitudeFeet,windSpeed:e,windDir:t})}}}return o.sort((e,t)=>e.altitudeFeet-t.altitudeFeet),n&&console.log(`[VFR Debug] getAllWindLevels found ${o.length} levels:`,o.map(e=>`${e.level}(${e.altitudeFeet}ft)`)),o}function gn(e,t,n){return null==e||isNaN(e)?null==t||isNaN(t)?null:t:null==t||isNaN(t)?e:e+(t-e)*n}async function fn(e,t,n,o,a,l,c=!1){try{const n=i.get("product");let u,p,g,f,h=null,v=["surface"];if(void 0!==l&&l>0)if(h=function(e){if(e<0)return null;if(e<dn[1].altitudeFeet)return{lower:dn[0],upper:dn[1],fraction:e/dn[1].altitudeFeet};for(let t=1;t<dn.length;t++){const n=dn[t-1],o=dn[t];if(e>=n.altitudeFeet&&e<=o.altitudeFeet){const t=o.altitudeFeet-n.altitudeFeet;return{lower:n,upper:o,fraction:t>0?(e-n.altitudeFeet)/t:0}}}return{lower:dn[dn.length-2],upper:dn[dn.length-1],fraction:1}}(l),h)v=["surface",h.lower.level,h.upper.level],v=[...new Set(v)],c&&a&&(console.log(`[VFR Planner] Fetching weather for ${a} at ${l} ft MSL`),console.log(`[VFR Planner] Interpolating between ${h.lower.level} (${h.lower.altitudeFeet}ft) and ${h.upper.level} (${h.upper.altitudeFeet}ft)`),console.log(`[VFR Planner] Interpolation fraction: ${(100*h.fraction).toFixed(1)}%`));else{const e=function(e){if(e<500)return"surface";for(let t=dn.length-1;t>=0;t--)if(e>=dn[t].altitudeFeet)return dn[t].level;return"surface"}(l);v="surface"===e?["surface"]:["surface",e],c&&a&&console.log(`[VFR Planner] Fetching weather for ${a} at ${l} ft MSL (pressure level: ${e})`)}else c&&a&&console.log(`[VFR Planner] Fetching weather for ${a} at surface`);try{const o={};v.length>0&&"surface"!==v[0]&&(o.levels=v);try{const i=await s(n,{lat:e,lon:t},o,{}),r=i.data?.data;if(!r||!r[`wind-${pressureLevel}`]&&!r.wind)throw new Error("No level-specific data in response");u=r}catch(o){c&&a&&console.log(`[VFR Planner] getPointForecastData doesn't support levels, trying direct API for ${a}`);const i={lat:e,lon:t,model:n,parameters:["wind","windDir","temp","dewPoint","pressure","rh","mm","cbase","gust"],levels:v},s="https://api.windy.com/api/point-forecast/v2",r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),l=r.status,d=r.statusText;let p="",g=null;try{p=await r.text(),p&&(g=JSON.parse(p))}catch(e){p="Could not parse response"}if(!r.ok)throw new Error(`Point Forecast API returned ${l}: ${d}`);u=g?.data||g}}catch(o){c&&a&&console.warn(`[VFR Planner] Point Forecast API failed for ${a}, falling back to surface data:`,o);const i=await s(n,{lat:e,lon:t},{},{});u=i.data?.data,h=null,c&&a&&console.log(`[VFR Planner] Using surface data fallback for ${a}`)}if(c&&a){console.log(`[VFR Debug] Response data keys for ${a}:`,Object.keys(u||{}));const e=Object.keys(u||{}).filter(e=>e.includes("wind"));console.log("[VFR Debug] Wind-related keys:",e);const t=[{key:"surface",alt:"10m AGL",desc:"Surface wind"},{key:"1000h",alt:"330 ft",desc:"Near surface"},{key:"950h",alt:"1,600 ft",desc:"Low level"},{key:"900h",alt:"3,300 ft",desc:"Boundary layer"},{key:"850h",alt:"5,000 ft",desc:"GA / Low clouds"},{key:"700h",alt:"10,000 ft",desc:"Mid-altitude"},{key:"500h",alt:"18,000 ft",desc:"Mid-troposphere"},{key:"300h",alt:"30,000 ft",desc:"Jet stream"},{key:"200h",alt:"39,000 ft",desc:"Upper troposphere"}];console.log(`[VFR Debug] ===== Wind at all levels for ${a} =====`),t.forEach(e=>{const t="surface"===e.key?"wind":`wind-${e.key}`,n="surface"===e.key?"windDir":`windDir-${e.key}`,o=u[t]||u[`wind-${e.key}`],i=u[n]||u[`windDir-${e.key}`];if(o&&i){const t=o[0],n=Math.round(1.94384*t),s=Math.round(i[0]);console.log(`[VFR Debug]   ${e.key.padEnd(8)} (${e.alt.padEnd(10)}): ${String(s).padStart(3,"0")}° @ ${String(n).padStart(2)}kt - ${e.desc}`)}else console.log(`[VFR Debug]   ${e.key.padEnd(8)} (${e.alt.padEnd(10)}): N/A - ${e.desc}`)}),console.log("[VFR Debug] ================================================")}let m="surface",w=[];console.log(`[VFR Debug] Fetching meteogram for ${a}, altitude=${l}...`);const b=await async function(e,t,n=!1){try{const o={model:"ecmwf",location:{lat:e,lon:t,step:1},options:{extended:"true"}};n&&(console.log("[VFR Debug] ========== getMeteogramForecastData REQUEST =========="),console.log("[VFR Debug] Request params:",JSON.stringify(o,null,2)));const i=await r("ecmwf",{lat:e,lon:t,step:1},{extended:"true"});if(n){if(console.log("[VFR Debug] ========== getMeteogramForecastData RAW RESPONSE =========="),console.log("[VFR Debug] Full result object:",i),console.log("[VFR Debug] Result type:",typeof i),console.log("[VFR Debug] Result keys:",i?Object.keys(i):"null"),i?.data&&(console.log("[VFR Debug] result.data keys:",Object.keys(i.data)),console.log("[VFR Debug] result.data:",i.data)),i?.data?.data){const e=Object.keys(i.data.data);console.log(`[VFR Debug] result.data.data keys (${e.length}):`,e);const t=e.filter(e=>e.includes("wind")||e.includes("Wind"));console.log("[VFR Debug] Wind-related keys:",t),t.length>0&&console.log(`[VFR Debug] Sample ${t[0]}:`,i.data.data[t[0]])}console.log("[VFR Debug] ========================================================")}return i?.data?.data||null}catch(e){return console.error("[VFR Planner] Error fetching vertical wind data:",e),n&&console.log("[VFR Debug] Error details:",e),null}}(e,t,!0);if(console.log(`[VFR Debug] Meteogram result for ${a}:`,b?`${Object.keys(b).length} keys`:"NULL"),b&&(w=pn(b,0,!0),console.log(`[VFR Debug] Extracted ${w.length} vertical wind levels`),c&&a&&console.log(`[VFR Planner] Vertical winds for ${a}:`,w.map(e=>`${e.level}(${e.altitudeFeet}ft): ${Math.round(e.windDir)}°@${Math.round(e.windSpeed)}kt`).join(", ")),void 0!==l&&l>0)){const e=function(e,t,n=0,o=!1){if(!e)return null;const i=pn(e,n,!1);if(0===i.length)return o&&console.log("[VFR Debug] getWindAtAltitude: No wind levels found in meteogram data"),null;const s=[...i].sort((e,t)=>e.altitudeFeet-t.altitudeFeet);o&&console.log(`[VFR Debug] getWindAtAltitude: target=${t}ft, available levels:`,s.map(e=>`${e.level}(${e.altitudeFeet}ft)`));let r,a,l,c=s[0],d=s[s.length-1];for(let e=0;e<s.length-1;e++)if(t>=s[e].altitudeFeet&&t<=s[e+1].altitudeFeet){c=s[e],d=s[e+1];break}if(t<s[0].altitudeFeet&&(c=s[0],d=s[0]),t>s[s.length-1].altitudeFeet&&(c=s[s.length-1],d=s[s.length-1]),c===d)r=c.windSpeed,a=c.windDir,l=c.level;else{const e=d.altitudeFeet-c.altitudeFeet,n=e>0?(t-c.altitudeFeet)/e:0;let i=d.windDir-c.windDir;i>180&&(i-=360),i<-180&&(i+=360),a=c.windDir+i*n,a<0&&(a+=360),a>=360&&(a-=360),r=c.windSpeed+(d.windSpeed-c.windSpeed)*n,l=`${c.level}-${d.level}`,o&&console.log(`[VFR Debug] Interpolating: ${c.level}(${c.altitudeFeet}ft) -> ${d.level}(${d.altitudeFeet}ft), fraction=${n.toFixed(2)}`)}return o&&console.log(`[VFR Debug] Result: ${Math.round(a)}° @ ${Math.round(r)}kt (level: ${l})`),{windSpeed:r,windDir:a,level:l}}(b,l,0,c);e&&(p=e.windSpeed,g=e.windDir,m=e.level,c&&a&&console.log(`[VFR Planner] ✓ Wind at ${l}ft for ${a}: ${Math.round(g)}° @ ${Math.round(p)}kt (level: ${m})`))}let y,x;void 0===p||void 0===g?(m="surface",y=u["wind-surface"]||u.wind,x=u["windDir-surface"]||u.windDir,f=u["gust-surface"]||u.gust,c&&a&&console.log(`[VFR Debug] Falling back to surface wind for ${a}:`,{windDataFound:!!y,windDirDataFound:!!x,windSample:y?.slice?.(0,3),windDirSample:x?.slice?.(0,3)})):f=u["gust-surface"]||u.gust;const $=u["temp-surface"]||u.temp,z=u["dewPoint-surface"]||u.dewPoint,M=u["pressure-surface"]||u.pressure,F=u["rh-surface"]||u.rh,N=u["mm-surface"]||u.mm,k=u["cbase-surface"]||u.cbase,P=u.ts||u["ts-surface"]||[];if(!P||0===P.length)return c&&console.error(`[VFR Planner] No timestamp data for ${a}`),null;const S=i.get("timestamp"),A=function(e,t){const n=t??Date.now();for(let t=0;t<e.length-1;t++)if(n>=e[t]&&n<=e[t+1]){const o=e[t+1]-e[t],i=o>0?(n-e[t])/o:0;return{lowerIndex:t,upperIndex:t+1,fraction:i,needsInterpolation:i>0&&i<1}}let o=0,i=Math.abs(e[0]-n);for(let t=1;t<e.length;t++){const s=Math.abs(e[t]-n);s<i&&(i=s,o=t)}return{lowerIndex:o,upperIndex:o,fraction:0,needsInterpolation:!1}}(P,o??S??Date.now()),{lowerIndex:D,upperIndex:E,fraction:T,needsInterpolation:I}=A;let C,R;if(void 0!==p&&void 0!==g)C=p,R=g;else{const e=y?.[D]||0;C=an(I?gn(e,y?.[E]||0,T)??0:e);const t=x?.[D]||0;if(R=t,I&&x){let e=(x?.[E]||0)-t;e>180&&(e-=360),e<-180&&(e+=360),R=t+e*T,R<0&&(R+=360),R>=360&&(R-=360)}}const L=$?.[D]||273.15,V=ln(I?gn(L,$?.[E]||273.15,T)??273.15:L);let O,W,B;if(z){const e=z[D],t=z[E],n=I?gn(e,t,T):e;null==n||isNaN(n)||(O=ln(n))}if(k&&Array.isArray(k)&&k.length>0){const e=k[D],t=k[E],n=null!=e&&!isNaN(e)&&e>0,o=null!=t&&!isNaN(t)&&t>0;let i=null;if(I?n&&o&&(i=gn(e,t,T)):i=n?e:o?t:null,null!=i&&!isNaN(i)&&i>0){W=i;const e=cn(W);B=`${Math.round(e)} ft`}}const _=f?I?gn(f[D],f[E],T)??0:f[D]||0:void 0,j={windSpeed:C,windDir:R,windGust:void 0!==_?an(_):void 0,windAltitude:l,windLevel:m,verticalWinds:w.length>0?w:void 0,temperature:V,dewPoint:O,pressure:M?I?(gn(M[D],M[E],T)??0)/100:(M[D]||0)/100:void 0,cloudBase:W,cloudBaseDisplay:B,humidity:F?I?gn(F[D],F[E],T)??void 0:F[D]:void 0,visibility:F?(d=I?gn(F[D],F[E],T)??0:F[D]||0,d>=100?.5:d>=95?2:d>=90?5:d>=80?10:20):void 0,precipitation:N?I?gn(N[D],N[E],T)??void 0:N[D]:void 0,timestamp:P[D]};return c&&a&&console.log(`[VFR Planner] Fetched weather for ${a} at ${m}:`,{windSpeed:`${Math.round(j.windSpeed)} kt`,windDir:`${Math.round(j.windDir)}°`,windAltitude:j.windAltitude?`${j.windAltitude} ft MSL`:"surface",temperature:`${Math.round(j.temperature)}°C`,pressureLevel:m}),j}catch(e){return console.error("Failed to fetch weather for waypoint:",e),null}var d}function hn(e,t,n){const o=`${Math.round(t).toString().padStart(3,"0")}°/${Math.round(e)} kt`;return void 0!==n&&n>0?`${o} @ ${Math.round(n)}ft`:o}function vn(e){return`${Math.round(e)}°C`}function mn(e,t,n){return e+(t-e)*n}function wn(e,t,n){let o=t-e;o>180&&(o-=360),o<-180&&(o+=360);let i=e+o*n;return i<0&&(i+=360),i>=360&&(i-=360),i}function bn(e,t){if(t.length<2)return null;let n=0;for(let o=0;o<t.length-1;o++){const i=t[o],s=t[o+1],r=i.distance||0,a=n+r;if(e>=n&&e<=a){return{prevWaypoint:i,nextWaypoint:s,prevIndex:o,nextIndex:o+1,prevDistance:n,nextDistance:a,fraction:r>0?(e-n)/r:0}}n=a}if(e>=n&&t.length>=2){const e=t.length-1;return{prevWaypoint:t[e-1],nextWaypoint:t[e],prevIndex:e-1,nextIndex:e,prevDistance:n-(t[e-1].distance||0),nextDistance:n,fraction:1}}return null}function yn(e,t){let n=0,o=0;if(void 0!==t){const i=t*Math.PI/180-e.windDir*Math.PI/180;n=e.windSpeed*Math.cos(i),o=e.windSpeed*Math.sin(i)}return{windSpeed:e.windSpeed,windDir:e.windDir,windGust:e.windGust,headwindComponent:n,crosswindComponent:o}}function xn(e){return 3.28084*e}function $n(e){return e+3e3}function zn(e,t,n,o=!1){const i=[];if(void 0===e.windSpeed||0===e.windSpeed)return{condition:"unknown",reasons:["Missing wind data"]};const s=e.terrainElevation??0,r=t-s,a=n?.visibility??10,l=n?.precipitation??0,c=n?.windGust;let d,u;if(void 0!==e.cloudBase){const n=e.cloudBase;if(d=n-s,u=n-t,t>=n)return i.push("Aircraft above cloud base (IMC)"),{condition:"poor",reasons:i}}const p={windSpeed:e.windSpeed,gustSpeed:c,cloudBaseAGL:d??999999,visibility:a,precipitation:l,terrainClearance:r,cloudClearance:u??999999};let g=!1,f=!1;return o&&(p.windSpeed>25?(i.push(`High wind (${Math.round(p.windSpeed)}kt)`),g=!0):p.windSpeed>20&&(i.push(`Elevated wind (${Math.round(p.windSpeed)}kt)`),f=!0),void 0!==p.gustSpeed&&(p.gustSpeed>35?(i.push(`High gusts (${Math.round(p.gustSpeed)}kt)`),g=!0):p.gustSpeed>30&&(i.push(`Elevated gusts (${Math.round(p.gustSpeed)}kt)`),f=!0))),void 0!==d&&(p.cloudBaseAGL<1500?(i.push(`Low ceiling (${Math.round(p.cloudBaseAGL)}ft AGL)`),g=!0):p.cloudBaseAGL<2e3&&(i.push(`Marginal ceiling (${Math.round(p.cloudBaseAGL)}ft AGL)`),f=!0)),p.visibility<5?(i.push(`Low visibility (${p.visibility.toFixed(1)}km)`),g=!0):p.visibility<8&&(i.push(`Reduced visibility (${p.visibility.toFixed(1)}km)`),f=!0),p.precipitation>5?(i.push(`Heavy precipitation (${p.precipitation.toFixed(1)}mm)`),g=!0):p.precipitation>2&&(i.push(`Moderate precipitation (${p.precipitation.toFixed(1)}mm)`),f=!0),p.terrainClearance<500?(i.push(`Low terrain clearance (${Math.round(p.terrainClearance)}ft)`),g=!0):p.terrainClearance<1e3&&(i.push(`Marginal terrain clearance (${Math.round(p.terrainClearance)}ft)`),f=!0),void 0!==u&&(p.cloudClearance<200?(i.push(`Insufficient cloud clearance (${Math.round(p.cloudClearance)}ft)`),g=!0):p.cloudClearance<500&&(i.push(`Marginal cloud clearance (${Math.round(p.cloudClearance)}ft)`),f=!0)),g?{condition:"poor",reasons:i}:f?{condition:"marginal",reasons:i}:{condition:"good",reasons:[]}}function Mn(e,t,n=3e3,o=[]){if(0===e.length)return[];const i=[];if(o.length>0)o.forEach(o=>{const s=xn(o.elevation),r=void 0!==o.waypointIndex,a=r?e[o.waypointIndex]:void 0,l=a?t.get(a.id):void 0,c=r&&a?a.altitude??n:function(e,t,n){if(0===t.length)return n;if(1===t.length)return t[0].altitude??n;let o=0;for(let i=0;i<t.length-1;i++){const s=t[i],r=t[i+1],a=s.distance||0;if(e>=o&&e<=o+a){const t=s.altitude??n;return t+((r.altitude??n)-t)*((e-o)/a)}o+=a}return t[t.length-1].altitude??n}(o.distance,e,n);let d,u,p=0,g=0,f=0,h=0;if(r&&a&&(console.log(`[Profile Debug] Waypoint ${a.name} (${a.id}): wx=${l?"found":"NOT FOUND"}, weatherData size=${t.size}`),!l&&t.size>0&&console.log("[Profile Debug] Available keys:",Array.from(t.keys()))),r&&l&&a){if(void 0!==l.cloudBase&&null!==l.cloudBase&&!isNaN(l.cloudBase)&&l.cloudBase>0){d=xn(l.cloudBase)+(s??0),u=$n(d)}if(f=l.windSpeed,h=l.windDir,void 0!==a.bearing){p=Yt(a.bearing,l.windDir,l.windSpeed);const e=a.bearing*Math.PI/180,t=l.windDir*Math.PI/180;g=l.windSpeed*Math.sin(e-t)}else if(o.waypointIndex>0){const t=e[o.waypointIndex-1];if(void 0!==t.bearing){p=Yt(t.bearing,l.windDir,l.windSpeed);const e=t.bearing*Math.PI/180,n=l.windDir*Math.PI/180;g=l.windSpeed*Math.sin(e-n)}}}else if(!r){const n=function(e,t){const n=bn(e,t);if(n)return n.prevWaypoint.bearing}(o.distance,e),i=function(e,t,n,o){const i={windSpeed:0,windDir:0,headwindComponent:0,crosswindComponent:0},s=bn(e,t);if(!s)return i;const r=n.get(s.prevWaypoint.id),a=n.get(s.nextWaypoint.id);if(!r&&!a)return i;if(!r&&a)return yn(a,o);if(r&&!a)return yn(r,o);const l=s.fraction,c=mn(r.windSpeed,a.windSpeed,l),d=wn(r.windDir,a.windDir,l);let u;void 0!==r.windGust&&void 0!==a.windGust?u=mn(r.windGust,a.windGust,l):void 0!==r.windGust?u=r.windGust:void 0!==a.windGust&&(u=a.windGust);let p=0,g=0;if(void 0!==o){const e=o*Math.PI/180-d*Math.PI/180;p=c*Math.cos(e),g=c*Math.sin(e)}return{windSpeed:c,windDir:d,windGust:u,headwindComponent:p,crosswindComponent:g}}(o.distance,e,t,n);f=i.windSpeed,h=i.windDir,p=i.headwindComponent,g=i.crosswindComponent}const v={distance:o.distance,altitude:c,terrainElevation:s,cloudBase:d,cloudTop:u,headwindComponent:p,crosswindComponent:g,windSpeed:f,windDir:h,verticalWinds:l?.verticalWinds,waypointId:a?.id,waypointName:a?.name};if(r&&a){const t=zn(v,c,l,0===o.waypointIndex||o.waypointIndex===e.length-1);v.condition=t.condition,v.conditionReasons=t.reasons}i.push(v)});else{let o=0;e.forEach((s,r)=>{const a=t.get(s.id),l=s.altitude??n,c=s.elevation?xn(s.elevation):void 0;let d,u;if(void 0!==a?.cloudBase&&null!==a.cloudBase&&!isNaN(a.cloudBase)&&a.cloudBase>0){d=xn(a.cloudBase)+(c??0),u=$n(d)}let p=0,g=0,f=0,h=0;if(a)if(f=a.windSpeed,h=a.windDir,void 0!==s.bearing){p=Yt(s.bearing,a.windDir,a.windSpeed);const e=s.bearing*Math.PI/180,t=a.windDir*Math.PI/180;g=a.windSpeed*Math.sin(e-t)}else if(r>0){const t=e[r-1];if(void 0!==t.bearing){p=Yt(t.bearing,a.windDir,a.windSpeed);const e=t.bearing*Math.PI/180,n=a.windDir*Math.PI/180;g=a.windSpeed*Math.sin(e-n)}}const v={distance:o,altitude:l,terrainElevation:c,cloudBase:d,cloudTop:u,headwindComponent:p,crosswindComponent:g,windSpeed:f,windDir:h,verticalWinds:a?.verticalWinds,waypointId:s.id,waypointName:s.name},m=zn(v,l,a,0===r||r===e.length-1);v.condition=m.condition,v.conditionReasons=m.reasons,i.push(v),r<e.length-1&&(o+=s.distance||0)})}return i}function Fn(e,t,n,o){const i=(n-e)*Math.PI/180,s=(o-t)*Math.PI/180,r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 3440.065*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function Nn(e,t,n,o,i){const s=e*Math.PI/180,r=t*Math.PI/180,a=n*Math.PI/180,l=o*Math.PI/180,c=2*Math.asin(Math.sqrt(Math.sin((a-s)/2)**2+Math.cos(s)*Math.cos(a)*Math.sin((l-r)/2)**2)),d=Math.sin((1-i)*c)/Math.sin(c),u=Math.sin(i*c)/Math.sin(c),p=d*Math.cos(s)*Math.cos(r)+u*Math.cos(a)*Math.cos(l),g=d*Math.cos(s)*Math.sin(r)+u*Math.cos(a)*Math.sin(l),f=d*Math.sin(s)+u*Math.sin(a),h=Math.atan2(f,Math.sqrt(p**2+g**2)),v=Math.atan2(g,p);return{lat:180*h/Math.PI,lon:180*v/Math.PI}}async function kn(e,t=5,n=!1){if(e.length<2)return n&&console.log("[VFR Planner] Not enough waypoints for elevation profile"),[];n&&(console.log("[VFR Planner] Original waypoint coordinates:"),e.forEach((e,t)=>{console.log(`  [${t}] ${e.name}: (${e.lat.toFixed(6)}, ${e.lon.toFixed(6)}), FPL elevation: ${e.elevation?e.elevation+"m":"N/A"}`)}));const o=function(e,t=5){if(e.length<2)return[];const n=[];let o=0;n.push({lat:e[0].lat,lon:e[0].lon,distance:0,waypointIndex:0});for(let i=0;i<e.length-1;i++){const s=e[i],r=e[i+1],a=Fn(s.lat,s.lon,r.lat,r.lon),l=Math.floor(a/t);for(let e=1;e<=l;e++){const i=e*t/a,l=Nn(s.lat,s.lon,r.lat,r.lon,i),c=o+e*t;n.push({lat:l.lat,lon:l.lon,distance:c})}o+=a,n.push({lat:r.lat,lon:r.lon,distance:o,waypointIndex:i+1})}return n}(e,t);n&&console.log(`[VFR Planner] Sampled ${o.length} points along ${e.length} waypoint route`);const i=await async function(e,t=!1){if(0===e.length)return[];try{const n=`https://api.open-meteo.com/v1/elevation?latitude=${e.map(e=>e.lat.toFixed(6)).join(",")}&longitude=${e.map(e=>e.lon.toFixed(6)).join(",")}`;t&&(console.log(`[VFR Planner] Fetching elevations for ${e.length} points from Open-Meteo...`),console.log(`[VFR Planner] API URL: ${n}`),console.log("[VFR Planner] First 5 points queried:",e.slice(0,5).map((e,t)=>`[${t}] (${e.lat.toFixed(6)}, ${e.lon.toFixed(6)}) @ ${e.distance.toFixed(1)}NM`)));const o=await fetch(n);if(!o.ok)throw new Error(`Open-Meteo API error: ${o.status} ${o.statusText}`);const i=await o.json();if(t&&console.log("[VFR Planner] Open-Meteo API response:",i),!i.elevation||!Array.isArray(i.elevation))throw new Error("Invalid response from Open-Meteo API");const s=e.map((e,t)=>({lat:e.lat,lon:e.lon,elevation:i.elevation[t],distance:e.distance,waypointIndex:e.waypointIndex}));if(t){console.log(`[VFR Planner] Received ${s.length} elevation points`),console.log(`[VFR Planner] Elevation range: ${Math.min(...i.elevation)}m to ${Math.max(...i.elevation)}m`),console.log("[VFR Planner] First 5 elevation points received:"),s.slice(0,5).forEach((e,t)=>{const n=void 0!==e.waypointIndex?` [WP ${e.waypointIndex}]`:"";console.log(`  [${t}]${n} (${e.lat.toFixed(6)}, ${e.lon.toFixed(6)}): ${e.elevation}m = ${(3.28084*e.elevation).toFixed(1)}ft @ ${e.distance.toFixed(1)}NM`)});const e=s.filter(e=>void 0!==e.waypointIndex);console.log(`[VFR Planner] Waypoint elevations (${e.length} waypoints):`),e.forEach(e=>{console.log(`  WP ${e.waypointIndex}: ${e.elevation}m = ${(3.28084*e.elevation).toFixed(1)}ft MSL`)})}return s}catch(e){return console.error("[VFR Planner] Error fetching elevations:",e),[]}}(o,n);return i}const Pn={defaultAirspeed:100,defaultAltitude:3e3,showLabels:!1,allowDrag:!0,enableLogging:!0,terrainSampleInterval:5,distanceUnit:"nm",altitudeUnit:"ft",speedUnit:"kt"};function Sn(e){h(e,"svelte-tougy9",".profile-empty.svelte-tougy9.svelte-tougy9{padding:20px;text-align:center;color:rgba(255, 255, 255, 0.7);font-size:13px}.profile-empty.svelte-tougy9 p.svelte-tougy9{margin:0}.profile-container.svelte-tougy9.svelte-tougy9{padding:10px;display:flex;flex-direction:column;gap:10px}.cursor-info.svelte-tougy9.svelte-tougy9{padding:8px;background:rgba(255, 255, 255, 0.05);border-radius:4px;font-size:11px;color:rgba(255, 255, 255, 0.9);text-align:center;display:flex;flex-direction:column;gap:6px}.cursor-waypoint-info.svelte-tougy9.svelte-tougy9{display:flex;flex-direction:column;gap:2px}.cursor-winds-section.svelte-tougy9.svelte-tougy9{display:flex;flex-direction:column;gap:2px;padding-top:4px;border-top:1px solid rgba(255, 255, 255, 0.2)}.cursor-row.svelte-tougy9.svelte-tougy9{height:16px;line-height:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.winds-row.svelte-tougy9.svelte-tougy9{display:flex;justify-content:center;gap:6px;flex-wrap:nowrap}.condition-legend.svelte-tougy9.svelte-tougy9{display:flex;gap:15px;padding:8px;background-color:rgba(0, 0, 0, 0.3);border-radius:4px;font-size:11px;justify-content:center;flex-wrap:wrap}.legend-item.svelte-tougy9.svelte-tougy9{display:flex;align-items:center;gap:6px}.legend-color.svelte-tougy9.svelte-tougy9{width:20px;height:3px;border-radius:2px}.legend-label.svelte-tougy9.svelte-tougy9{color:rgba(255, 255, 255, 0.8)}.vertical-winds-label.svelte-tougy9.svelte-tougy9{color:rgba(255, 255, 255, 0.7);font-weight:bold;font-size:10px}.wind-level.svelte-tougy9.svelte-tougy9{color:rgba(255, 255, 255, 0.6);padding:1px 3px;background:rgba(255, 255, 255, 0.1);border-radius:3px;font-size:10px}.wind-level.flight-level.svelte-tougy9.svelte-tougy9{color:#4caf50;background:rgba(76, 175, 80, 0.2);font-weight:bold}.wind-level-empty.svelte-tougy9.svelte-tougy9{color:rgba(255, 255, 255, 0.4);font-size:10px;font-style:italic}.cursor-condition.svelte-tougy9.svelte-tougy9{font-weight:bold}.graph-container.svelte-tougy9.svelte-tougy9{width:100%;overflow-x:auto;background:rgba(0, 0, 0, 0.2);border-radius:4px;padding:10px}.profile-graph.svelte-tougy9.svelte-tougy9{display:block;background:#1a1a1a}")}function An(e,t,n){const o=e.slice();return o[30]=t[n],o}function Dn(e,t,n){const o=e.slice();return o[30]=t[n],o[34]=n,o}function En(e,t,n){const o=e.slice();o[36]=t[n];const i=o[14](o[36].altitudeFeet);o[37]=i;const s=function(e,t){const n=Math.abs(e-t);return n<500?"rgba(76, 175, 80, 0.95)":n<2e3?"rgba(255, 193, 7, 0.8)":"rgba(255, 255, 255, 0.5)"}(o[36].altitudeFeet,o[30].altitude);o[38]=s;const r=function(e,t,n,o,i=.6){const s=20*i,r=8*i,a=4*i,l=6*i,c=(n-90)*Math.PI/180,d=e+Math.cos(c)*s,u=t+Math.sin(c)*s,p=`M ${e},${t} L ${d},${u}`,g=[];let f=Math.round(o),h=0;const v=4*i;for(;f>=50;){const n=e+Math.cos(c)*(s-h),o=t+Math.sin(c)*(s-h),i=c+Math.PI/2,r=n+Math.cos(i)*l,a=o+Math.sin(i)*l,d=n+Math.cos(c)*l,u=o+Math.sin(c)*l;g.push({path:`M ${n},${o} L ${r},${a} L ${d},${u} Z`,type:"triangle"}),f-=50,h+=1.5*v}for(;f>=10;){const n=e+Math.cos(c)*(s-h),o=t+Math.sin(c)*(s-h),i=c+Math.PI/2,a=n+Math.cos(i)*r,l=o+Math.sin(i)*r;g.push({path:`M ${n},${o} L ${a},${l}`,type:"long"}),f-=10,h+=v}if(f>=5){const n=e+Math.cos(c)*(s-h),o=t+Math.sin(c)*(s-h),i=c+Math.PI/2,r=n+Math.cos(i)*a,l=o+Math.sin(i)*a;g.push({path:`M ${n},${o} L ${r},${l}`,type:"short"})}if(o<3)return{staff:"",barbs:[]};return{staff:p,barbs:g}}(o[35],o[37],o[36].windDir,o[36].windSpeed);return o[39]=r,o}function Tn(e,t,n){const o=e.slice();return o[42]=t[n],o}function In(e){const t=e.slice(),n=t[13](t[30].distance);return t[35]=n,t}function Cn(e,t,n){const o=e.slice();return o[30]=t[n],o[46]=n,o}function Rn(e){const t=e.slice(),n=t[11][t[46]+1];t[47]=n;const o=Do(t[30].condition);return t[48]=o,t}function Ln(e,t,n){const o=e.slice();return o[30]=t[n],o[46]=n,o}function Vn(e){const t=e.slice(),n=t[14](t[30].cloudTop);t[50]=n;const o=t[14](t[30].cloudBase);t[51]=o;const i=Math.abs(t[51]-t[50]);t[52]=i;const s=Math.min(t[50],t[51]);return t[53]=s,t}function On(e){const t=e.slice(),n=t[11][t[46]+1];return t[47]=n,t}function Wn(e,t,n){const o=e.slice();return o[54]=t[n],o}function Bn(e,t,n){const o=e.slice();return o[54]=t[n],o}function _n(e,t,n){const o=e.slice();o[36]=t[n];const i=o[6]&&Math.abs(o[36].altitudeFeet-o[6].altitude)<500;return o[60]=i,o}function jn(e){const t=e.slice(),n=t[6].verticalWinds.filter(e=>e.altitudeFeet<=t[1]).sort((e,t)=>t.altitudeFeet-e.altitudeFeet);return t[59]=n,t}function Gn(e,t,n){const o=e.slice();o[36]=t[n];const i=o[6]&&Math.abs(o[36].altitudeFeet-o[6].altitude)<500;return o[60]=i,o}function Un(e){let t,n,o,i,s,r,a,l,c,u,g,h,w,x,z,F,k,P,S,D,E,T,I,C,R,L,V,O,W,B,_=e[10],j=e[0].enableLogging&&Xn(e);function G(e,t){return e[6]?Yn:Hn}let U=G(e),q=U(e);function X(e,t){return e[6]&&e[6].windSpeed>0?Jn:Zn}let H=X(e),Y=H(e);function Z(e,t){return void 0!==e[6]?.cloudBase?eo:Qn}let J=Z(e),K=J(e);function Q(e,t){return e[6]?.condition?no:to}let ee=Q(e),te=ee(e);function ne(e,t){return e[6]?.verticalWinds&&e[6].verticalWinds.length>0?io:oo}function oe(e,t){return t===io?function(e){const t=e.slice(),n=t[6].verticalWinds.filter(e=>e.altitudeFeet<=t[1]).sort((e,t)=>t.altitudeFeet-e.altitudeFeet);return t[59]=n,t}(e):e}let ie=ne(e),se=ie(oe(e,ie)),re=e[6]?.verticalWinds&&e[6].verticalWinds.length>0&&ro(jn(e)),ae=Po(e);return{c(){t=b("div"),j&&j.c(),n=$(),o=b("div"),o.innerHTML='<div class="legend-item svelte-tougy9"><span class="legend-color svelte-tougy9" style="background-color: #4caf50;"></span> <span class="legend-label svelte-tougy9">Good VFR</span></div> <div class="legend-item svelte-tougy9"><span class="legend-color svelte-tougy9" style="background-color: #ff9800;"></span> <span class="legend-label svelte-tougy9">Marginal VFR</span></div> <div class="legend-item svelte-tougy9"><span class="legend-color svelte-tougy9" style="background-color: #f44336;"></span> <span class="legend-label svelte-tougy9">Poor VFR</span></div> <div class="legend-item svelte-tougy9"><span class="legend-color svelte-tougy9" style="background-color: #757575;"></span> <span class="legend-label svelte-tougy9">No Data</span></div>',i=$(),s=b("div"),r=b("div"),a=b("div"),q.c(),l=$(),c=b("div"),Y.c(),u=$(),K.c(),g=$(),h=b("div"),te.c(),w=$(),x=b("div"),z=b("div"),F=b("span"),F.textContent="Winds Aloft:",k=$(),se.c(),P=$(),S=b("div"),re&&re.c(),D=$(),E=b("div"),T=y("svg"),I=y("defs"),C=y("linearGradient"),R=y("stop"),L=y("stop"),V=y("stop"),ae.c(),N(o,"class","condition-legend svelte-tougy9"),N(a,"class","cursor-row svelte-tougy9"),N(c,"class","cursor-row svelte-tougy9"),N(h,"class","cursor-row cursor-condition svelte-tougy9"),A(h,"color",e[6]?.condition?Do(e[6].condition):"rgba(255,255,255,0.4)"),N(r,"class","cursor-waypoint-info svelte-tougy9"),N(F,"class","vertical-winds-label svelte-tougy9"),N(z,"class","cursor-row winds-row svelte-tougy9"),N(S,"class","cursor-row winds-row svelte-tougy9"),N(x,"class","cursor-winds-section svelte-tougy9"),N(s,"class","cursor-info svelte-tougy9"),N(R,"offset","0%"),A(R,"stop-color","#d4a574"),A(R,"stop-opacity","1"),N(L,"offset","40%"),A(L,"stop-color","#a67c52"),A(L,"stop-opacity","1"),N(V,"offset","100%"),A(V,"stop-color","#6b4423"),A(V,"stop-opacity","1"),N(C,"id","terrainGradient"),N(C,"x1","0%"),N(C,"y1","0%"),N(C,"x2","0%"),N(C,"y2","100%"),N(T,"class","profile-graph svelte-tougy9"),N(T,"width",e[3]),N(T,"height",Ao),N(T,"viewBox",O=`0 0 ${e[3]} ${Ao}`),N(E,"class","graph-container svelte-tougy9"),N(t,"class","profile-container svelte-tougy9")},m(d,p){v(d,t,p),j&&j.m(t,null),f(t,n),f(t,o),f(t,i),f(t,s),f(s,r),f(r,a),q.m(a,null),f(r,l),f(r,c),Y.m(c,null),f(c,u),K.m(c,null),f(r,g),f(r,h),te.m(h,null),f(s,w),f(s,x),f(x,z),f(z,F),f(z,k),se.m(z,null),f(x,P),f(x,S),re&&re.m(S,null),f(t,D),f(t,E),f(E,T),f(T,I),f(I,C),f(C,R),f(C,L),f(C,V),ae.m(T,null),e[27](T),W||(B=[M(T,"mousemove",e[15]),M(T,"mouseleave",e[16])],W=!0)},p(e,o){e[0].enableLogging?j?j.p(e,o):(j=Xn(e),j.c(),j.m(t,n)):j&&(j.d(1),j=null),U===(U=G(e))&&q?q.p(e,o):(q.d(1),q=U(e),q&&(q.c(),q.m(a,null))),H===(H=X(e))&&Y?Y.p(e,o):(Y.d(1),Y=H(e),Y&&(Y.c(),Y.m(c,u))),J===(J=Z(e))&&K?K.p(e,o):(K.d(1),K=J(e),K&&(K.c(),K.m(c,null))),ee===(ee=Q(e))&&te?te.p(e,o):(te.d(1),te=ee(e),te&&(te.c(),te.m(h,null))),64&o[0]&&A(h,"color",e[6]?.condition?Do(e[6].condition):"rgba(255,255,255,0.4)"),ie===(ie=ne(e))&&se?se.p(oe(e,ie),o):(se.d(1),se=ie(oe(e,ie)),se&&(se.c(),se.m(z,null))),e[6]?.verticalWinds&&e[6].verticalWinds.length>0?re?re.p(jn(e),o):(re=ro(jn(e)),re.c(),re.m(S,null)):re&&(re.d(1),re=null),1024&o[0]&&p(_,_=e[10])?(ae.d(1),ae=Po(e),ae.c(),ae.m(T,null)):ae.p(e,o),8&o[0]&&N(T,"width",e[3]),8&o[0]&&O!==(O=`0 0 ${e[3]} ${Ao}`)&&N(T,"viewBox",O)},d(n){n&&m(t),j&&j.d(),q.d(),Y.d(),K.d(),te.d(),se.d(),re&&re.d(),ae.d(n),e[27](null),W=!1,d(B)}}}function qn(e){let t;return{c(){t=b("div"),t.innerHTML='<p class="svelte-tougy9">No profile data available. Please ensure you have at least 2 waypoints and weather data.</p>',N(t,"class","profile-empty svelte-tougy9")},m(e,n){v(e,t,n)},p:a,d(e){e&&m(t)}}}function Xn(e){let t,n,o,i,s,r,a,l,c,d=e[11].length+"",u=e[2].filter(e[22]).length+"",p=e[11].filter(e[23]).length+"",g=e[11].filter(Eo).length+"";return{c(){t=b("div"),n=x("Waypoints: "),o=x(d),i=x(" |\n            Terrain samples: "),s=x(u),r=x(" |\n            Clouds: "),a=x(p),l=x(" |\n            Wind: "),c=x(g),N(t,"class","debug-info"),A(t,"font-size","10px"),A(t,"color","rgba(255,255,255,0.5)"),A(t,"padding","4px")},m(e,d){v(e,t,d),f(t,n),f(t,o),f(t,i),f(t,s),f(t,r),f(t,a),f(t,l),f(t,c)},p(e,t){2048&t[0]&&d!==(d=e[11].length+"")&&P(o,d),4&t[0]&&u!==(u=e[2].filter(e[22]).length+"")&&P(s,u),2048&t[0]&&p!==(p=e[11].filter(e[23]).length+"")&&P(a,p),2048&t[0]&&g!==(g=e[11].filter(Eo).length+"")&&P(c,g)},d(e){e&&m(t)}}}function Hn(e){let t;return{c(){t=x("Altitude: -- | Terrain: -- | Distance: --")},m(e,n){v(e,t,n)},p:a,d(e){e&&m(t)}}}function Yn(e){let t,n,o,i,s,r,a,l=Math.round(e[6].altitude)+"",c=void 0!==e[6].terrainElevation?Math.round(e[6].terrainElevation)+"ft":"--",d=e[6].distance.toFixed(1)+"";return{c(){t=x("Altitude: "),n=x(l),o=x("ft | Terrain: "),i=x(c),s=x(" | Distance: "),r=x(d),a=x("NM")},m(e,l){v(e,t,l),v(e,n,l),v(e,o,l),v(e,i,l),v(e,s,l),v(e,r,l),v(e,a,l)},p(e,t){64&t[0]&&l!==(l=Math.round(e[6].altitude)+"")&&P(n,l),64&t[0]&&c!==(c=void 0!==e[6].terrainElevation?Math.round(e[6].terrainElevation)+"ft":"--")&&P(i,c),64&t[0]&&d!==(d=e[6].distance.toFixed(1)+"")&&P(r,d)},d(e){e&&(m(t),m(n),m(o),m(i),m(s),m(r),m(a))}}}function Zn(e){let t;return{c(){t=x("Wind: --")},m(e,n){v(e,t,n)},p:a,d(e){e&&m(t)}}}function Jn(e){let t,n,o,i,s,r,a=e[6].windSpeed.toFixed(0)+"",l=Math.round(e[6].windDir)+"",c=0!==e[6].headwindComponent&&Kn(e);return{c(){t=x("Wind: "),n=x(a),o=x("kt @ "),i=x(l),s=x("°\n                    "),c&&c.c(),r=z()},m(e,a){v(e,t,a),v(e,n,a),v(e,o,a),v(e,i,a),v(e,s,a),c&&c.m(e,a),v(e,r,a)},p(e,t){64&t[0]&&a!==(a=e[6].windSpeed.toFixed(0)+"")&&P(n,a),64&t[0]&&l!==(l=Math.round(e[6].windDir)+"")&&P(i,l),0!==e[6].headwindComponent?c?c.p(e,t):(c=Kn(e),c.c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null)},d(e){e&&(m(t),m(n),m(o),m(i),m(s),m(r)),c&&c.d(e)}}}function Kn(e){let t,n,o,i,s,r=e[6].headwindComponent>0?"HW":"TW",a=Math.abs(e[6].headwindComponent).toFixed(0)+"";return{c(){t=x("("),n=x(r),o=$(),i=x(a),s=x("kt)")},m(e,r){v(e,t,r),v(e,n,r),v(e,o,r),v(e,i,r),v(e,s,r)},p(e,t){64&t[0]&&r!==(r=e[6].headwindComponent>0?"HW":"TW")&&P(n,r),64&t[0]&&a!==(a=Math.abs(e[6].headwindComponent).toFixed(0)+"")&&P(i,a)},d(e){e&&(m(t),m(n),m(o),m(i),m(s))}}}function Qn(e){let t;return{c(){t=x("| Cloud: --")},m(e,n){v(e,t,n)},p:a,d(e){e&&m(t)}}}function eo(e){let t,n,o,i,s,r=Math.round(e[6].cloudBase)+"",a=Math.round(e[6].cloudTop||0)+"";return{c(){t=x("| Cloud: "),n=x(r),o=x("-"),i=x(a),s=x("ft")},m(e,r){v(e,t,r),v(e,n,r),v(e,o,r),v(e,i,r),v(e,s,r)},p(e,t){64&t[0]&&r!==(r=Math.round(e[6].cloudBase)+"")&&P(n,r),64&t[0]&&a!==(a=Math.round(e[6].cloudTop||0)+"")&&P(i,a)},d(e){e&&(m(t),m(n),m(o),m(i),m(s))}}}function to(e){let t;return{c(){t=x("Conditions: --")},m(e,n){v(e,t,n)},p:a,d(e){e&&m(t)}}}function no(e){let t,n,o=e[6].condition.toUpperCase()+"";return{c(){t=x("Conditions: "),n=x(o)},m(e,o){v(e,t,o),v(e,n,o)},p(e,t){64&t[0]&&o!==(o=e[6].condition.toUpperCase()+"")&&P(n,o)},d(e){e&&(m(t),m(n))}}}function oo(e){let t;return{c(){t=b("span"),t.textContent="No data",N(t,"class","wind-level-empty svelte-tougy9")},m(e,n){v(e,t,n)},p:a,d(e){e&&m(t)}}}function io(e){let t,n=oe(e[59].slice(0,4)),o=[];for(let t=0;t<n.length;t+=1)o[t]=so(Gn(e,n,t));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=z()},m(e,n){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,n);v(e,t,n)},p(e,i){if(66&i[0]){let s;for(n=oe(e[59].slice(0,4)),s=0;s<n.length;s+=1){const r=Gn(e,n,s);o[s]?o[s].p(r,i):(o[s]=so(r),o[s].c(),o[s].m(t.parentNode,t))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(e){e&&m(t),w(o,e)}}}function so(e){let t,n,o,i,s,r,a,l=Math.round(e[36].altitudeFeet/1e3)+"",c=String(Math.round(e[36].windDir)).padStart(3,"0")+"",d=Math.round(e[36].windSpeed)+"";return{c(){t=b("span"),n=x(l),o=x("k:"),i=x(c),s=x("°/"),r=x(d),a=x("kt\n                        "),N(t,"class","wind-level svelte-tougy9"),D(t,"flight-level",e[60])},m(e,l){v(e,t,l),f(t,n),f(t,o),f(t,i),f(t,s),f(t,r),f(t,a)},p(e,o){66&o[0]&&l!==(l=Math.round(e[36].altitudeFeet/1e3)+"")&&P(n,l),66&o[0]&&c!==(c=String(Math.round(e[36].windDir)).padStart(3,"0")+"")&&P(i,c),66&o[0]&&d!==(d=Math.round(e[36].windSpeed)+"")&&P(r,d),66&o[0]&&D(t,"flight-level",e[60])},d(e){e&&m(t)}}}function ro(e){let t,n=e[59].length>4&&ao(e);return{c(){n&&n.c(),t=z()},m(e,o){n&&n.m(e,o),v(e,t,o)},p(e,o){e[59].length>4?n?n.p(e,o):(n=ao(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&m(t),n&&n.d(e)}}}function ao(e){let t,n=oe(e[59].slice(4,8)),o=[];for(let t=0;t<n.length;t+=1)o[t]=lo(_n(e,n,t));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=z()},m(e,n){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,n);v(e,t,n)},p(e,i){if(66&i[0]){let s;for(n=oe(e[59].slice(4,8)),s=0;s<n.length;s+=1){const r=_n(e,n,s);o[s]?o[s].p(r,i):(o[s]=lo(r),o[s].c(),o[s].m(t.parentNode,t))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(e){e&&m(t),w(o,e)}}}function lo(e){let t,n,o,i,s,r,a,l=Math.round(e[36].altitudeFeet/1e3)+"",c=String(Math.round(e[36].windDir)).padStart(3,"0")+"",d=Math.round(e[36].windSpeed)+"";return{c(){t=b("span"),n=x(l),o=x("k:"),i=x(c),s=x("°/"),r=x(d),a=x("kt\n                            "),N(t,"class","wind-level svelte-tougy9"),D(t,"flight-level",e[60])},m(e,l){v(e,t,l),f(t,n),f(t,o),f(t,i),f(t,s),f(t,r),f(t,a)},p(e,o){66&o[0]&&l!==(l=Math.round(e[36].altitudeFeet/1e3)+"")&&P(n,l),66&o[0]&&c!==(c=String(Math.round(e[36].windDir)).padStart(3,"0")+"")&&P(i,c),66&o[0]&&d!==(d=Math.round(e[36].windSpeed)+"")&&P(r,d),66&o[0]&&D(t,"flight-level",e[60])},d(e){e&&m(t)}}}function co(e){let t,n,o,i,s,r,a,l=e[54].label+"";return{c(){t=y("line"),s=y("text"),r=x(l),N(t,"x1",e[12].left),N(t,"y1",n=e[54].y),N(t,"x2",o=e[3]-e[12].right),N(t,"y2",i=e[54].y),N(t,"stroke","rgba(255, 255, 255, 0.1)"),N(t,"stroke-width","1"),N(s,"x",e[12].left-10),N(s,"y",a=e[54].y+4),N(s,"fill","rgba(255, 255, 255, 0.6)"),N(s,"font-size","10"),N(s,"text-anchor","end")},m(e,n){v(e,t,n),v(e,s,n),f(s,r)},p(e,c){512&c[0]&&n!==(n=e[54].y)&&N(t,"y1",n),8&c[0]&&o!==(o=e[3]-e[12].right)&&N(t,"x2",o),512&c[0]&&i!==(i=e[54].y)&&N(t,"y2",i),512&c[0]&&l!==(l=e[54].label+"")&&P(r,l),512&c[0]&&a!==(a=e[54].y+4)&&N(s,"y",a)},d(e){e&&(m(t),m(s))}}}function uo(e){let t,n,o,i,s,r,a=e[54].label+"";return{c(){t=y("line"),i=y("text"),s=x(a),N(t,"x1",n=e[54].x),N(t,"y1",e[12].top),N(t,"x2",o=e[54].x),N(t,"y2",Ao-e[12].bottom),N(t,"stroke","rgba(255, 255, 255, 0.1)"),N(t,"stroke-width","1"),N(i,"x",r=e[54].x),N(i,"y",Ao-e[12].bottom+20),N(i,"fill","rgba(255, 255, 255, 0.6)"),N(i,"font-size","10"),N(i,"text-anchor","middle")},m(e,n){v(e,t,n),v(e,i,n),f(i,s)},p(e,l){256&l[0]&&n!==(n=e[54].x)&&N(t,"x1",n),256&l[0]&&o!==(o=e[54].x)&&N(t,"x2",o),256&l[0]&&a!==(a=e[54].label+"")&&P(s,a),256&l[0]&&r!==(r=e[54].x)&&N(i,"x",r)},d(e){e&&(m(t),m(i))}}}function po(e){let t,n=void 0!==e[30].cloudBase&&void 0!==e[30].cloudTop&&e[30].cloudBase>0&&e[30].cloudTop>0&&go(Vn(e));return{c(){n&&n.c(),t=z()},m(e,o){n&&n.m(e,o),v(e,t,o)},p(e,o){void 0!==e[30].cloudBase&&void 0!==e[30].cloudTop&&e[30].cloudBase>0&&e[30].cloudTop>0?n?n.p(Vn(e),o):(n=go(Vn(e)),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&m(t),n&&n.d(e)}}}function go(e){let t,n=e[52]>0&&e[30].cloudTop<=e[1]&&fo(e);return{c(){n&&n.c(),t=z()},m(e,o){n&&n.m(e,o),v(e,t,o)},p(e,o){e[52]>0&&e[30].cloudTop<=e[1]?n?n.p(e,o):(n=fo(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&m(t),n&&n.d(e)}}}function fo(e){let t,n,o,i,s;return{c(){t=y("rect"),N(t,"x",n=e[13](e[30].distance)),N(t,"y",o=e[53]),N(t,"width",i=Math.max(1,e[13](e[47].distance)-e[13](e[30].distance))),N(t,"height",s=e[52]),N(t,"fill","rgba(100, 150, 200, 0.4)"),N(t,"stroke","rgba(100, 150, 200, 0.6)"),N(t,"stroke-width","1")},m(e,n){v(e,t,n)},p(e,r){2048&r[0]&&n!==(n=e[13](e[30].distance))&&N(t,"x",n),2048&r[0]&&o!==(o=e[53])&&N(t,"y",o),2048&r[0]&&i!==(i=Math.max(1,e[13](e[47].distance)-e[13](e[30].distance)))&&N(t,"width",i),2048&r[0]&&s!==(s=e[52])&&N(t,"height",s)},d(e){e&&m(t)}}}function ho(e){let t,n=e[46]<e[11].length-1&&po(On(e));return{c(){n&&n.c(),t=z()},m(e,o){n&&n.m(e,o),v(e,t,o)},p(e,o){e[46]<e[11].length-1?n?n.p(On(e),o):(n=po(On(e)),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&m(t),n&&n.d(e)}}}function vo(e){let t;return{c(){t=y("polygon"),N(t,"points",e[7]),N(t,"fill","url(#terrainGradient)"),N(t,"stroke","#8b6914"),N(t,"stroke-width","2.5"),N(t,"opacity","1")},m(e,n){v(e,t,n)},p(e,n){128&n[0]&&N(t,"points",e[7])},d(e){e&&m(t)}}}function mo(e){let t,n,o,i,s,r;return{c(){t=y("line"),N(t,"x1",n=e[13](e[30].distance)),N(t,"y1",o=e[14](e[30].altitude)),N(t,"x2",i=e[13](e[47].distance)),N(t,"y2",s=e[14](e[47].altitude)),N(t,"stroke",r=e[48]),N(t,"stroke-width","3"),N(t,"stroke-linecap","round")},m(e,n){v(e,t,n)},p(e,a){2048&a[0]&&n!==(n=e[13](e[30].distance))&&N(t,"x1",n),2048&a[0]&&o!==(o=e[14](e[30].altitude))&&N(t,"y1",o),2048&a[0]&&i!==(i=e[13](e[47].distance))&&N(t,"x2",i),2048&a[0]&&s!==(s=e[14](e[47].altitude))&&N(t,"y2",s),2048&a[0]&&r!==(r=e[48])&&N(t,"stroke",r)},d(e){e&&m(t)}}}function wo(e){let t,n=e[46]<e[11].length-1&&mo(Rn(e));return{c(){n&&n.c(),t=z()},m(e,o){n&&n.m(e,o),v(e,t,o)},p(e,o){e[46]<e[11].length-1?n?n.p(Rn(e),o):(n=mo(Rn(e)),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&m(t),n&&n.d(e)}}}function bo(e){let t,n=oe(e[30].verticalWinds.filter(e[24])),o=[];for(let t=0;t<n.length;t+=1)o[t]=$o(En(e,n,t));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=z()},m(e,n){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,n);v(e,t,n)},p(e,i){if(26626&i[0]){let s;for(n=oe(e[30].verticalWinds.filter(e[24])),s=0;s<n.length;s+=1){const r=En(e,n,s);o[s]?o[s].p(r,i):(o[s]=$o(r),o[s].c(),o[s].m(t.parentNode,t))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(e){e&&m(t),w(o,e)}}}function yo(e){let t,n,o;return{c(){t=y("path"),N(t,"d",n=e[39].staff),N(t,"stroke",o=e[38]),N(t,"stroke-width","1.5"),N(t,"fill","none")},m(e,n){v(e,t,n)},p(e,i){2050&i[0]&&n!==(n=e[39].staff)&&N(t,"d",n),2050&i[0]&&o!==(o=e[38])&&N(t,"stroke",o)},d(e){e&&m(t)}}}function xo(e){let t,n,o,i;return{c(){t=y("path"),N(t,"d",n=e[42].path),N(t,"stroke",o=e[38]),N(t,"stroke-width","1.5"),N(t,"fill",i="triangle"===e[42].type?e[38]:"none"),N(t,"stroke-linejoin","miter")},m(e,n){v(e,t,n)},p(e,s){2050&s[0]&&n!==(n=e[42].path)&&N(t,"d",n),2050&s[0]&&o!==(o=e[38])&&N(t,"stroke",o),2050&s[0]&&i!==(i="triangle"===e[42].type?e[38]:"none")&&N(t,"fill",i)},d(e){e&&m(t)}}}function $o(e){let t,n,o,i,s,r=e[39].staff&&yo(e),a=oe(e[39].barbs),l=[];for(let t=0;t<a.length;t+=1)l[t]=xo(Tn(e,a,t));return{c(){r&&r.c(),t=z();for(let e=0;e<l.length;e+=1)l[e].c();n=y("circle"),N(n,"cx",o=e[35]),N(n,"cy",i=e[37]),N(n,"r","2"),N(n,"fill",s=e[38])},m(e,o){r&&r.m(e,o),v(e,t,o);for(let t=0;t<l.length;t+=1)l[t]&&l[t].m(e,o);v(e,n,o)},p(e,c){if(e[39].staff?r?r.p(e,c):(r=yo(e),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null),26626&c[0]){let t;for(a=oe(e[39].barbs),t=0;t<a.length;t+=1){const o=Tn(e,a,t);l[t]?l[t].p(o,c):(l[t]=xo(o),l[t].c(),l[t].m(n.parentNode,n))}for(;t<l.length;t+=1)l[t].d(1);l.length=a.length}2048&c[0]&&o!==(o=e[35])&&N(n,"cx",o),2050&c[0]&&i!==(i=e[37])&&N(n,"cy",i),2050&c[0]&&s!==(s=e[38])&&N(n,"fill",s)},d(e){e&&(m(t),m(n)),r&&r.d(e),w(l,e)}}}function zo(e){let t,n=e[30].verticalWinds&&e[30].verticalWinds.length>0&&bo(In(e));return{c(){n&&n.c(),t=z()},m(e,o){n&&n.m(e,o),v(e,t,o)},p(e,o){e[30].verticalWinds&&e[30].verticalWinds.length>0?n?n.p(In(e),o):(n=bo(In(e)),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){e&&m(t),n&&n.d(e)}}}function Mo(e){let t,n,o,i,s,r=e[30].waypointName+"";function a(){return e[26](e[30])}return{c(){t=y("text"),n=x(r),N(t,"x",o=e[13](e[30].distance)),N(t,"y",e[12].top-5),N(t,"fill","rgba(255, 255, 255, 0.9)"),N(t,"font-size","11"),N(t,"font-weight","500"),N(t,"text-anchor","middle"),A(t,"cursor","pointer")},m(e,o){v(e,t,o),f(t,n),i||(s=M(t,"click",a),i=!0)},p(i,s){e=i,2048&s[0]&&r!==(r=e[30].waypointName+"")&&P(n,r),2048&s[0]&&o!==(o=e[13](e[30].distance))&&N(t,"x",o)},d(e){e&&m(t),i=!1,s()}}}function Fo(e){let t,n,o,i,s,r,a,l,c;function d(){return e[25](e[30])}let u=e[30].waypointName&&Mo(e);return{c(){t=y("line"),i=y("circle"),u&&u.c(),a=z(),N(t,"x1",n=e[13](e[30].distance)),N(t,"y1",e[12].top),N(t,"x2",o=e[13](e[30].distance)),N(t,"y2",Ao-e[12].bottom),N(t,"stroke","rgba(255, 255, 255, 0.3)"),N(t,"stroke-width","1"),N(t,"stroke-dasharray","2,2"),N(i,"cx",s=e[13](e[30].distance)),N(i,"cy",r=e[14](e[30].altitude)),N(i,"r","5"),N(i,"fill","#ff00ff"),N(i,"stroke","white"),N(i,"stroke-width","2"),A(i,"cursor","pointer")},m(e,n){v(e,t,n),v(e,i,n),u&&u.m(e,n),v(e,a,n),l||(c=M(i,"click",d),l=!0)},p(l,c){e=l,2048&c[0]&&n!==(n=e[13](e[30].distance))&&N(t,"x1",n),2048&c[0]&&o!==(o=e[13](e[30].distance))&&N(t,"x2",o),2048&c[0]&&s!==(s=e[13](e[30].distance))&&N(i,"cx",s),2048&c[0]&&r!==(r=e[14](e[30].altitude))&&N(i,"cy",r),e[30].waypointName?u?u.p(e,c):(u=Mo(e),u.c(),u.m(a.parentNode,a)):u&&(u.d(1),u=null)},d(e){e&&(m(t),m(i),m(a)),u&&u.d(e),l=!1,c()}}}function No(e){let t,n,o,i,s=e[6]&&ko(e);return{c(){t=y("line"),s&&s.c(),i=z(),N(t,"x1",n=e[13](e[5])),N(t,"y1",e[12].top),N(t,"x2",o=e[13](e[5])),N(t,"y2",Ao-e[12].bottom),N(t,"stroke","rgba(255, 255, 255, 0.5)"),N(t,"stroke-width","1"),N(t,"stroke-dasharray","4,4")},m(e,n){v(e,t,n),s&&s.m(e,n),v(e,i,n)},p(e,r){32&r[0]&&n!==(n=e[13](e[5]))&&N(t,"x1",n),32&r[0]&&o!==(o=e[13](e[5]))&&N(t,"x2",o),e[6]?s?s.p(e,r):(s=ko(e),s.c(),s.m(i.parentNode,i)):s&&(s.d(1),s=null)},d(e){e&&(m(t),m(i)),s&&s.d(e)}}}function ko(e){let t,n,o;return{c(){t=y("circle"),N(t,"cx",n=e[13](e[5])),N(t,"cy",o=e[14](e[6].altitude)),N(t,"r","6"),N(t,"fill","white"),N(t,"stroke","#3498db"),N(t,"stroke-width","2")},m(e,n){v(e,t,n)},p(e,i){32&i[0]&&n!==(n=e[13](e[5]))&&N(t,"cx",n),64&i[0]&&o!==(o=e[14](e[6].altitude))&&N(t,"cy",o)},d(e){e&&m(t)}}}function Po(e){let t,n,o,i,s,r,a,l,c=oe(e[9]),d=[];for(let t=0;t<c.length;t+=1)d[t]=co(Bn(e,c,t));let u=oe(e[8]),p=[];for(let t=0;t<u.length;t+=1)p[t]=uo(Wn(e,u,t));let g=oe(e[11]),f=[];for(let t=0;t<g.length;t+=1)f[t]=ho(Ln(e,g,t));let h=e[7]&&vo(e),b=oe(e[11]),y=[];for(let t=0;t<b.length;t+=1)y[t]=wo(Cn(e,b,t));let x=oe(e[11]),$=[];for(let t=0;t<x.length;t+=1)$[t]=zo(Dn(e,x,t));let M=oe(e[11]),F=[];for(let t=0;t<M.length;t+=1)F[t]=Fo(An(e,M,t));let N=null!==e[5]&&No(e);return{c(){for(let e=0;e<d.length;e+=1)d[e].c();t=z();for(let e=0;e<p.length;e+=1)p[e].c();n=z();for(let e=0;e<f.length;e+=1)f[e].c();o=z(),h&&h.c(),i=z();for(let e=0;e<y.length;e+=1)y[e].c();s=z();for(let e=0;e<$.length;e+=1)$[e].c();r=z();for(let e=0;e<F.length;e+=1)F[e].c();a=z(),N&&N.c(),l=z()},m(e,c){for(let t=0;t<d.length;t+=1)d[t]&&d[t].m(e,c);v(e,t,c);for(let t=0;t<p.length;t+=1)p[t]&&p[t].m(e,c);v(e,n,c);for(let t=0;t<f.length;t+=1)f[t]&&f[t].m(e,c);v(e,o,c),h&&h.m(e,c),v(e,i,c);for(let t=0;t<y.length;t+=1)y[t]&&y[t].m(e,c);v(e,s,c);for(let t=0;t<$.length;t+=1)$[t]&&$[t].m(e,c);v(e,r,c);for(let t=0;t<F.length;t+=1)F[t]&&F[t].m(e,c);v(e,a,c),N&&N.m(e,c),v(e,l,c)},p(e,v){if(4616&v[0]){let n;for(c=oe(e[9]),n=0;n<c.length;n+=1){const o=Bn(e,c,n);d[n]?d[n].p(o,v):(d[n]=co(o),d[n].c(),d[n].m(t.parentNode,t))}for(;n<d.length;n+=1)d[n].d(1);d.length=c.length}if(4352&v[0]){let t;for(u=oe(e[8]),t=0;t<u.length;t+=1){const o=Wn(e,u,t);p[t]?p[t].p(o,v):(p[t]=uo(o),p[t].c(),p[t].m(n.parentNode,n))}for(;t<p.length;t+=1)p[t].d(1);p.length=u.length}if(26626&v[0]){let t;for(g=oe(e[11]),t=0;t<g.length;t+=1){const n=Ln(e,g,t);f[t]?f[t].p(n,v):(f[t]=ho(n),f[t].c(),f[t].m(o.parentNode,o))}for(;t<f.length;t+=1)f[t].d(1);f.length=g.length}if(e[7]?h?h.p(e,v):(h=vo(e),h.c(),h.m(i.parentNode,i)):h&&(h.d(1),h=null),26624&v[0]){let t;for(b=oe(e[11]),t=0;t<b.length;t+=1){const n=Cn(e,b,t);y[t]?y[t].p(n,v):(y[t]=wo(n),y[t].c(),y[t].m(s.parentNode,s))}for(;t<y.length;t+=1)y[t].d(1);y.length=b.length}if(26626&v[0]){let t;for(x=oe(e[11]),t=0;t<x.length;t+=1){const n=Dn(e,x,t);$[t]?$[t].p(n,v):($[t]=zo(n),$[t].c(),$[t].m(r.parentNode,r))}for(;t<$.length;t+=1)$[t].d(1);$.length=x.length}if(161792&v[0]){let t;for(M=oe(e[11]),t=0;t<M.length;t+=1){const n=An(e,M,t);F[t]?F[t].p(n,v):(F[t]=Fo(n),F[t].c(),F[t].m(a.parentNode,a))}for(;t<F.length;t+=1)F[t].d(1);F.length=M.length}null!==e[5]?N?N.p(e,v):(N=No(e),N.c(),N.m(l.parentNode,l)):N&&(N.d(1),N=null)},d(e){e&&(m(t),m(n),m(o),m(i),m(s),m(r),m(a),m(l)),w(d,e),w(p,e),w(f,e),h&&h.d(e),w(y,e),w($,e),w(F,e),N&&N.d(e)}}}function So(e){let t;function n(e,t){return 0===e[2].length?qn:Un}let o=n(e),i=o(e);return{c(){i.c(),t=z()},m(e,n){i.m(e,n),v(e,t,n)},p(e,s){o===(o=n(e))&&i?i.p(e,s):(i.d(1),i=o(e),i&&(i.c(),i.m(t.parentNode,t)))},i:a,o:a,d(e){e&&m(t),i.d(e)}}}let Ao=400;function Do(e){switch(e){case"good":return"#4caf50";case"marginal":return"#ff9800";case"poor":return"#f44336";default:return"#757575"}}const Eo=e=>e.windSpeed>0;function To(e,t,n){let o,i,s,r,a,l,{flightPlan:c}=t,{weatherData:d}=t,{elevationProfile:u=[]}=t,{settings:p}=t,{maxAltitude:g=15e3}=t,{scale:f=511}=t;const h=C(),v={top:20,right:20,bottom:40,left:60};let m,w=600,b=null,y=null;function x(e){if(0===o.length)return v.left;const t=Math.max(...o.map(e=>e.distance));if(0===t)return v.left;return v.left+e/t*(w-v.left-v.right)}function $(e){return v.top+(1-e/g)*(Ao-v.top-v.bottom)}function z(e){h("waypointClick",e)}return e.$$set=e=>{"flightPlan"in e&&n(18,c=e.flightPlan),"weatherData"in e&&n(19,d=e.weatherData),"elevationProfile"in e&&n(20,u=e.elevationProfile),"settings"in e&&n(0,p=e.settings),"maxAltitude"in e&&n(1,g=e.maxAltitude),"scale"in e&&n(21,f=e.scale)},e.$$.update=()=>{if(1835008&e.$$.dirty[0]&&n(2,o=Mn(c.waypoints,d,c.aircraft.defaultAltitude,u)),4&e.$$.dirty[0]&&n(11,i=o.filter(e=>void 0!==e.waypointId)),2&e.$$.dirty[0]&&n(10,s=`${g}-${Ao}`),2097156&e.$$.dirty[0])if(o.length>0){const e=1852*Math.max(...o.map(e=>e.distance));n(3,w=Math.max(600,Math.min(1200,e/f)))}else n(3,w=600);2&e.$$.dirty[0]&&n(9,r=(()=>{const e=[],t=g/5;for(let n=0;n<=5;n++){const o=n*t;e.push({y:$(o),label:`${Math.round(o)}ft`})}return e})()),4&e.$$.dirty[0]&&n(8,a=(()=>{if(0===o.length)return[];const e=Math.max(...o.map(e=>e.distance));if(0===e)return[];const t=[],n=e/5;for(let e=0;e<=5;e++){const o=e*n;t.push({x:x(o),label:`${o.toFixed(1)}NM`})}return t})()),7&e.$$.dirty[0]&&n(7,l=(()=>{if(0===o.length)return p.enableLogging&&console.log("[Profile] No profile data for terrain"),"";const e=o.filter(e=>void 0!==e.terrainElevation);if(0===e.length)return p.enableLogging&&console.log("[Profile] No terrain elevation data in profile points"),"";const t=Ao-v.bottom,n=[];n.push(`${x(e[0].distance)},${t}`),e.forEach(e=>{n.push(`${x(e.distance)},${$(e.terrainElevation)}`)}),n.push(`${x(e[e.length-1].distance)},${t}`);const i=n.join(" ");return p.enableLogging&&(console.log(`[Profile] Terrain path generated: ${e.length} points`),console.log(`[Profile] Terrain elevation range: ${Math.min(...e.map(e=>e.terrainElevation))}ft to ${Math.max(...e.map(e=>e.terrainElevation))}ft`),console.log("[Profile] First 3 terrain points:",e.slice(0,3).map(e=>`${e.distance.toFixed(1)}NM @ ${e.terrainElevation.toFixed(0)}ft`))),i})())},[p,g,o,w,m,b,y,l,a,r,s,i,v,x,$,function(e){if(!m)return;const t=m.getBoundingClientRect(),i=e.clientX-t.left,s=o.length>0?Math.max(...o.map(e=>e.distance)):0,r=(i-v.left)/(w-v.left-v.right)*s;r>=0&&r<=s?(n(5,b=r),n(6,y=function(e){if(0===o.length)return null;if(1===o.length)return o[0];for(let t=0;t<o.length-1;t++){const n=o[t],i=o[t+1];if(e>=n.distance&&e<=i.distance){const t=(e-n.distance)/(i.distance-n.distance),o=t<.5?n.verticalWinds:i.verticalWinds;return{distance:e,altitude:n.altitude+(i.altitude-n.altitude)*t,terrainElevation:void 0!==n.terrainElevation&&void 0!==i.terrainElevation?n.terrainElevation+(i.terrainElevation-n.terrainElevation)*t:void 0,cloudBase:void 0!==n.cloudBase&&void 0!==i.cloudBase?n.cloudBase+(i.cloudBase-n.cloudBase)*t:void 0,cloudTop:void 0!==n.cloudTop&&void 0!==i.cloudTop?n.cloudTop+(i.cloudTop-n.cloudTop)*t:void 0,headwindComponent:n.headwindComponent+(i.headwindComponent-n.headwindComponent)*t,crosswindComponent:n.crosswindComponent+(i.crosswindComponent-n.crosswindComponent)*t,windSpeed:n.windSpeed+(i.windSpeed-n.windSpeed)*t,windDir:wn(n.windDir,i.windDir,t),verticalWinds:o,condition:n.condition,conditionReasons:n.conditionReasons}}}return e>=o[o.length-1].distance?o[o.length-1]:o[0]}(r))):(n(5,b=null),n(6,y=null))},function(){n(5,b=null),n(6,y=null)},z,c,d,u,f,e=>void 0!==e.terrainElevation,e=>void 0!==e.cloudBase,e=>e.altitudeFeet<=g&&e.windSpeed>=3,e=>e.waypointId&&z(e.waypointId),e=>e.waypointId&&z(e.waypointId),function(e){V[e?"unshift":"push"](()=>{m=e,n(4,m)})}]}class Io extends le{constructor(e){super(),ae(this,e,To,So,p,{flightPlan:18,weatherData:19,elevationProfile:20,settings:0,maxAltitude:1,scale:21},Sn,[-1,-1,-1])}}const{Map:Co}=g;function Ro(e){h(e,"svelte-4szoo7",'.tabs.svelte-4szoo7.svelte-4szoo7{display:flex;padding:0 10px;gap:4px;margin-bottom:10px}.tab.svelte-4szoo7.svelte-4szoo7{flex:1;padding:8px 12px;background:rgba(255, 255, 255, 0.05);border:none;border-radius:4px;color:rgba(255, 255, 255, 0.7);cursor:pointer;font-size:13px;transition:all 0.15s ease}.tab.svelte-4szoo7.svelte-4szoo7:hover{background:rgba(255, 255, 255, 0.1)}.tab.active.svelte-4szoo7.svelte-4szoo7{background:#3498db;color:white}.tab.svelte-4szoo7.svelte-4szoo7:disabled{opacity:0.5;cursor:not-allowed}.profile-empty.svelte-4szoo7.svelte-4szoo7{padding:20px;text-align:center;color:rgba(255, 255, 255, 0.7);font-size:13px}.profile-empty.svelte-4szoo7 p.svelte-4szoo7{margin:0}.import-section.svelte-4szoo7.svelte-4szoo7{padding:10px}.drop-zone.svelte-4szoo7.svelte-4szoo7{border:2px dashed rgba(255, 255, 255, 0.3);border-radius:8px;padding:20px;text-align:center;transition:all 0.2s ease;cursor:pointer}.drop-zone.drag-over.svelte-4szoo7.svelte-4szoo7{border-color:#3498db;background:rgba(52, 152, 219, 0.1)}.drop-zone.svelte-4szoo7.svelte-4szoo7:hover{border-color:rgba(255, 255, 255, 0.5)}.drop-zone-content.svelte-4szoo7.svelte-4szoo7{display:flex;flex-direction:column;align-items:center;gap:8px}.drop-icon.svelte-4szoo7.svelte-4szoo7{font-size:32px}.btn-browse.svelte-4szoo7.svelte-4szoo7{margin-top:8px;padding:6px 16px;background:#3498db;border:none;border-radius:4px;color:white;cursor:pointer;font-size:13px}.btn-browse.svelte-4szoo7.svelte-4szoo7:hover{background:#2980b9}.flight-plan-loaded.svelte-4szoo7.svelte-4szoo7{display:flex;align-items:center;justify-content:space-between;gap:10px}.plan-name.svelte-4szoo7.svelte-4szoo7{font-weight:500;color:#3498db}.btn-clear.svelte-4szoo7.svelte-4szoo7{padding:4px 8px;background:rgba(255, 255, 255, 0.1);border:none;border-radius:4px;color:rgba(255, 255, 255, 0.7);cursor:pointer}.btn-clear.svelte-4szoo7.svelte-4szoo7:hover{background:rgba(231, 76, 60, 0.3);color:#e74c3c}.loading.svelte-4szoo7.svelte-4szoo7{color:#3498db}.error-message.svelte-4szoo7.svelte-4szoo7{margin-top:10px;padding:8px;background:rgba(231, 76, 60, 0.2);border-radius:4px;color:#e74c3c;font-size:12px}.departure-section.svelte-4szoo7.svelte-4szoo7{padding:0 10px 10px;border-bottom:1px solid rgba(255, 255, 255, 0.1);margin-bottom:10px}.departure-header.svelte-4szoo7.svelte-4szoo7{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.departure-label.svelte-4szoo7.svelte-4szoo7{font-size:12px;color:rgba(255, 255, 255, 0.7)}.departure-time.svelte-4szoo7.svelte-4szoo7{font-size:13px;font-weight:500;color:#3498db}.timeline-slider.svelte-4szoo7.svelte-4szoo7{position:relative}.slider.svelte-4szoo7.svelte-4szoo7{width:100%;height:6px;-webkit-appearance:none;appearance:none;background:rgba(255, 255, 255, 0.1);border-radius:3px;outline:none;cursor:pointer}.slider.svelte-4szoo7.svelte-4szoo7::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:18px;height:18px;background:#3498db;border-radius:50%;cursor:pointer;box-shadow:0 2px 4px rgba(0, 0, 0, 0.3);transition:transform 0.15s ease}.slider.svelte-4szoo7.svelte-4szoo7::-webkit-slider-thumb:hover{transform:scale(1.1)}.slider.svelte-4szoo7.svelte-4szoo7::-moz-range-thumb{width:18px;height:18px;background:#3498db;border-radius:50%;cursor:pointer;border:none;box-shadow:0 2px 4px rgba(0, 0, 0, 0.3)}.timeline-labels.svelte-4szoo7.svelte-4szoo7{display:flex;justify-content:space-between;margin-top:4px;font-size:10px;color:rgba(255, 255, 255, 0.5)}.departure-footer.svelte-4szoo7.svelte-4szoo7{display:flex;justify-content:space-between;align-items:center;margin-top:6px}.arrival-info.svelte-4szoo7.svelte-4szoo7{font-size:11px;color:rgba(255, 255, 255, 0.6)}.btn-sync.svelte-4szoo7.svelte-4szoo7{padding:4px 8px;background:rgba(255, 255, 255, 0.1);border:none;border-radius:4px;color:rgba(255, 255, 255, 0.6);cursor:pointer;font-size:10px;transition:all 0.15s ease}.btn-sync.svelte-4szoo7.svelte-4szoo7:hover{background:rgba(255, 255, 255, 0.15);color:rgba(255, 255, 255, 0.8)}.btn-sync.active.svelte-4szoo7.svelte-4szoo7{background:rgba(39, 174, 96, 0.3);color:#27ae60}.action-buttons.svelte-4szoo7.svelte-4szoo7{display:flex;gap:8px;padding:0 10px 10px}.btn-action.svelte-4szoo7.svelte-4szoo7{flex:1;padding:8px 12px;background:rgba(255, 255, 255, 0.1);border:none;border-radius:4px;color:rgba(255, 255, 255, 0.9);cursor:pointer;font-size:12px;transition:all 0.15s ease}.btn-action.svelte-4szoo7.svelte-4szoo7:hover{background:rgba(255, 255, 255, 0.15)}.btn-action.active.svelte-4szoo7.svelte-4szoo7{background:#27ae60;color:white}.btn-action.svelte-4szoo7.svelte-4szoo7:disabled{opacity:0.6;cursor:not-allowed}.btn-action.btn-weather.has-alerts.svelte-4szoo7.svelte-4szoo7{background:rgba(243, 156, 18, 0.3);border:1px solid #f39c12}.weather-error.svelte-4szoo7.svelte-4szoo7{margin:0 10px 10px;padding:8px;background:rgba(231, 76, 60, 0.2);border-radius:4px;color:#e74c3c;font-size:12px}.waypoint-section.svelte-4szoo7.svelte-4szoo7{padding:0 10px 10px}.section-header.svelte-4szoo7.svelte-4szoo7{display:flex;justify-content:space-between;align-items:center;padding:8px 0;font-size:12px;color:rgba(255, 255, 255, 0.7);border-bottom:1px solid rgba(255, 255, 255, 0.1)}.totals.svelte-4szoo7.svelte-4szoo7{font-weight:500;color:#3498db}.waypoint-table.svelte-4szoo7.svelte-4szoo7{max-height:350px;overflow-y:auto}.waypoint-row.svelte-4szoo7.svelte-4szoo7{display:flex;align-items:center;padding:8px 4px;border-bottom:1px solid rgba(255, 255, 255, 0.05);cursor:pointer;transition:background 0.15s ease}.waypoint-row.svelte-4szoo7.svelte-4szoo7:hover{background:rgba(255, 255, 255, 0.05)}.waypoint-row.svelte-4szoo7:hover .btn-move.svelte-4szoo7,.waypoint-row.svelte-4szoo7:hover .btn-delete.svelte-4szoo7{opacity:1}.waypoint-row.selected.svelte-4szoo7.svelte-4szoo7{background:rgba(52, 152, 219, 0.2)}.waypoint-row.has-warning.svelte-4szoo7.svelte-4szoo7{border-left:3px solid #e74c3c}.waypoint-row.has-caution.svelte-4szoo7.svelte-4szoo7:not(.has-warning){border-left:3px solid #f39c12}.wp-index.svelte-4szoo7.svelte-4szoo7{width:24px;font-size:11px;color:rgba(255, 255, 255, 0.5);text-align:center}.wp-info.svelte-4szoo7.svelte-4szoo7{flex:1;min-width:0}.wp-name.svelte-4szoo7.svelte-4szoo7{display:flex;align-items:center;gap:6px;font-weight:500}.wp-type-icon.svelte-4szoo7.svelte-4szoo7{font-size:14px}.wp-comment.svelte-4szoo7.svelte-4szoo7{font-size:11px;color:rgba(255, 255, 255, 0.5);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wp-weather.svelte-4szoo7.svelte-4szoo7{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px;font-size:10px;color:rgba(255, 255, 255, 0.7)}.wx-wind.svelte-4szoo7.svelte-4szoo7,.wx-temp.svelte-4szoo7.svelte-4szoo7,.wx-cloud.svelte-4szoo7.svelte-4szoo7{display:inline-flex;align-items:center;gap:2px}.wx-cloud.clickable.svelte-4szoo7.svelte-4szoo7{cursor:pointer;text-decoration:underline;opacity:0.9}.wx-cloud.clickable.svelte-4szoo7.svelte-4szoo7:hover{opacity:1;color:#3498db}.alert-badge.svelte-4szoo7.svelte-4szoo7{font-size:12px;margin-left:4px}.alert-badge.warning.svelte-4szoo7.svelte-4szoo7{animation:svelte-4szoo7-pulse 1s ease-in-out infinite}@keyframes svelte-4szoo7-pulse{0%,100%{opacity:1}50%{opacity:0.5}}.alert-row.svelte-4szoo7.svelte-4szoo7{display:flex;flex-wrap:wrap;gap:6px;padding:4px 4px 8px 28px;border-bottom:1px solid rgba(255, 255, 255, 0.05)}.alert-item.svelte-4szoo7.svelte-4szoo7{display:inline-block;padding:2px 6px;background:rgba(243, 156, 18, 0.2);border-radius:3px;font-size:10px;color:#f39c12}.alert-item.warning.svelte-4szoo7.svelte-4szoo7{background:rgba(231, 76, 60, 0.2);color:#e74c3c}.wp-nav.svelte-4szoo7.svelte-4szoo7{text-align:right;font-size:11px;min-width:60px}.wp-bearing.svelte-4szoo7.svelte-4szoo7{color:rgba(255, 255, 255, 0.7)}.wp-distance.svelte-4szoo7.svelte-4szoo7{color:#3498db}.wp-gs.svelte-4szoo7.svelte-4szoo7{color:#27ae60;font-weight:500}.wp-actions.svelte-4szoo7.svelte-4szoo7{display:flex;gap:2px;align-items:center}.btn-move.svelte-4szoo7.svelte-4szoo7{padding:2px 6px;background:transparent;border:none;color:rgba(255, 255, 255, 0.3);cursor:pointer;opacity:0;transition:all 0.15s ease;font-size:10px;line-height:1}.btn-move.svelte-4szoo7.svelte-4szoo7:hover:not(:disabled){color:#3498db;background:rgba(52, 152, 219, 0.1)}.btn-move.svelte-4szoo7.svelte-4szoo7:disabled{opacity:0.2;cursor:not-allowed}.btn-delete.svelte-4szoo7.svelte-4szoo7{padding:4px 6px;background:transparent;border:none;color:rgba(255, 255, 255, 0.3);cursor:pointer;opacity:0;transition:all 0.15s ease;font-size:12px}.btn-delete.svelte-4szoo7.svelte-4szoo7:hover{color:#e74c3c}.settings-section.svelte-4szoo7.svelte-4szoo7{padding:10px}.setting-group.svelte-4szoo7.svelte-4szoo7{margin-bottom:16px}.setting-label.svelte-4szoo7.svelte-4szoo7{display:block;font-size:12px;color:rgba(255, 255, 255, 0.7);margin-bottom:6px}.setting-input.svelte-4szoo7.svelte-4szoo7{display:flex;align-items:center;gap:8px}.setting-input.svelte-4szoo7 input[type="number"].svelte-4szoo7{width:100px;padding:8px;background:rgba(255, 255, 255, 0.1);border:1px solid rgba(255, 255, 255, 0.2);border-radius:4px;color:white;font-size:14px}.setting-input.svelte-4szoo7 input[type="number"].svelte-4szoo7:focus{outline:none;border-color:#3498db}.setting-input.svelte-4szoo7 .unit.svelte-4szoo7{font-size:12px;color:rgba(255, 255, 255, 0.5)}.setting-checkbox.svelte-4szoo7.svelte-4szoo7{display:flex;align-items:center;gap:8px;font-size:13px;color:rgba(255, 255, 255, 0.9);cursor:pointer}.setting-checkbox.svelte-4szoo7 input[type="checkbox"].svelte-4szoo7{width:16px;height:16px;cursor:pointer}.setting-description.svelte-4szoo7.svelte-4szoo7{margin-top:6px;font-size:11px;color:rgba(255, 255, 255, 0.5);line-height:1.4}.setting-info.svelte-4szoo7.svelte-4szoo7{margin-top:20px;padding:10px;background:rgba(52, 152, 219, 0.1);border-radius:4px;font-size:12px;color:rgba(255, 255, 255, 0.6)}.setting-info.svelte-4szoo7 p.svelte-4szoo7{margin:0}')}function Lo(e,t,n){const o=e.slice();o[80]=t[n],o[84]=n;const i=o[35](o[80].id);o[81]=i;const s=o[36](o[80].id);return o[82]=s,o}function Vo(e,t,n){const o=e.slice();return o[85]=t[n],o}function Oo(e){let t,n,o,i,s,r,a,l,c,u;return{c(){t=b("div"),n=b("button"),n.textContent="Route",o=$(),i=b("button"),s=x("Profile"),a=$(),l=b("button"),l.textContent="Settings",N(n,"class","tab svelte-4szoo7"),D(n,"active","route"===e[6]),N(i,"class","tab svelte-4szoo7"),i.disabled=r=!e[0]||e[0].waypoints.length<2,D(i,"active","profile"===e[6]),N(l,"class","tab svelte-4szoo7"),D(l,"active","settings"===e[6]),N(t,"class","tabs svelte-4szoo7")},m(r,d){v(r,t,d),f(t,n),f(t,o),f(t,i),f(i,s),f(t,a),f(t,l),c||(u=[M(n,"click",e[42]),M(i,"click",e[43]),M(l,"click",e[44])],c=!0)},p(e,t){64&t[0]&&D(n,"active","route"===e[6]),1&t[0]&&r!==(r=!e[0]||e[0].waypoints.length<2)&&(i.disabled=r),64&t[0]&&D(i,"active","profile"===e[6]),64&t[0]&&D(l,"active","settings"===e[6])},d(e){e&&m(t),c=!1,d(u)}}}function Wo(e){let t,n,o,i,s,r,a,l=e[0].name+"";return{c(){t=b("div"),n=b("span"),o=x(l),i=$(),s=b("button"),s.textContent="✕",N(n,"class","plan-name svelte-4szoo7"),N(s,"class","btn-clear svelte-4szoo7"),N(s,"title","Clear flight plan"),N(t,"class","flight-plan-loaded svelte-4szoo7")},m(l,c){v(l,t,c),f(t,n),f(n,o),f(t,i),f(t,s),r||(a=M(s,"click",e[23]),r=!0)},p(e,t){1&t[0]&&l!==(l=e[0].name+"")&&P(o,l)},d(e){e&&m(t),r=!1,a()}}}function Bo(e){let t,n,o,i,s,r,l,c;return{c(){t=b("div"),n=b("span"),n.textContent="✈️",o=$(),i=b("span"),i.textContent="Drop .fpl file here",s=$(),r=b("button"),r.textContent="Browse...",N(n,"class","drop-icon svelte-4szoo7"),N(r,"class","btn-browse svelte-4szoo7"),N(t,"class","drop-zone-content svelte-4szoo7")},m(a,d){v(a,t,d),f(t,n),f(t,o),f(t,i),f(t,s),f(t,r),l||(c=M(r,"click",e[46]),l=!0)},p:a,d(e){e&&m(t),l=!1,c()}}}function _o(e){let t;return{c(){t=b("span"),t.textContent="Loading...",N(t,"class","loading svelte-4szoo7")},m(e,n){v(e,t,n)},p:a,d(e){e&&m(t)}}}function jo(e){let t,n;return{c(){t=b("div"),n=x(e[4]),N(t,"class","error-message svelte-4szoo7")},m(e,o){v(e,t,o),f(t,n)},p(e,t){16&t[0]&&P(n,e[4])},d(e){e&&m(t)}}}function Go(e){let t,n,o=e[0]&&Uo(e),i=e[0]&&e[0].waypoints.length>0&&Jo(e);return{c(){o&&o.c(),t=$(),i&&i.c(),n=z()},m(e,s){o&&o.m(e,s),v(e,t,s),i&&i.m(e,s),v(e,n,s)},p(e,s){e[0]?o?o.p(e,s):(o=Uo(e),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),e[0]&&e[0].waypoints.length>0?i?i.p(e,s):(i=Jo(e),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(e){e&&(m(t),m(n)),o&&o.d(e),i&&i.d(e)}}}function Uo(e){let t,n,o,i,s,r,a,l,c,u,p,g,h,w,y,F,k=e[7]?"✓ Click map":"➕ Add Point";function S(e,t){return e[9]?Xo:qo}let A=S(e),E=A(e),T=e[10]&&Ho(e),I=e[13]&&Yo(e);return{c(){t=b("div"),n=b("button"),E.c(),o=$(),i=b("button"),i.textContent="📥 Export GPX",s=$(),r=b("button"),r.textContent="🗺️ Send to D&P",a=$(),l=b("button"),l.textContent="🔄 Reverse",c=$(),u=b("button"),p=x(k),g=$(),T&&T.c(),h=$(),I&&I.c(),w=z(),N(n,"class","btn-action btn-weather svelte-4szoo7"),n.disabled=e[9],N(n,"title","Fetch weather for all waypoints"),D(n,"has-alerts",e[37]()),N(i,"class","btn-action svelte-4szoo7"),N(i,"title","Export as GPX"),N(r,"class","btn-action svelte-4szoo7"),N(r,"title","Open route in Windy Distance & Planning (new window)"),N(l,"class","btn-action svelte-4szoo7"),N(l,"title","Reverse the route order"),N(u,"class","btn-action svelte-4szoo7"),N(u,"title","Click on map to add waypoint"),D(u,"active",e[7]),N(t,"class","action-buttons svelte-4szoo7")},m(d,m){v(d,t,m),f(t,n),E.m(n,null),f(t,o),f(t,i),f(t,s),f(t,r),f(t,a),f(t,l),f(t,c),f(t,u),f(u,p),v(d,g,m),T&&T.m(d,m),v(d,h,m),I&&I.m(d,m),v(d,w,m),y||(F=[M(n,"click",e[34]),M(i,"click",e[31]),M(r,"click",e[32]),M(l,"click",e[33]),M(u,"click",e[29])],y=!0)},p(e,t){A!==(A=S(e))&&(E.d(1),E=A(e),E&&(E.c(),E.m(n,null))),512&t[0]&&(n.disabled=e[9]),128&t[0]&&k!==(k=e[7]?"✓ Click map":"➕ Add Point")&&P(p,k),128&t[0]&&D(u,"active",e[7]),e[10]?T?T.p(e,t):(T=Ho(e),T.c(),T.m(h.parentNode,h)):T&&(T.d(1),T=null),e[13]?I?I.p(e,t):(I=Yo(e),I.c(),I.m(w.parentNode,w)):I&&(I.d(1),I=null)},d(e){e&&(m(t),m(g),m(h),m(w)),E.d(),T&&T.d(e),I&&I.d(e),y=!1,d(F)}}}function qo(e){let t;return{c(){t=x("🌤️ Read Wx")},m(e,n){v(e,t,n)},d(e){e&&m(t)}}}function Xo(e){let t;return{c(){t=x("⏳ Loading...")},m(e,n){v(e,t,n)},d(e){e&&m(t)}}}function Ho(e){let t,n;return{c(){t=b("div"),n=x(e[10]),N(t,"class","weather-error svelte-4szoo7")},m(e,o){v(e,t,o),f(t,n)},p(e,t){1024&t[0]&&P(n,e[10])},d(e){e&&m(t)}}}function Yo(e){let t,n,o,i,s,r,a,l,c,u,p,g,h,w,y,z,F,k,A,E,T,I,C,R,L,V,O,W=mi(e[12])+"",B=wi(e[13].start)+"",_=wi(e[13].end)+"",j=e[14]?"Synced":"Sync",G=e[0]&&e[0].totals.ete>0&&Zo(e);return{c(){t=b("div"),n=b("div"),o=b("span"),o.textContent="🕐 Departure",i=$(),s=b("span"),r=x(W),a=$(),l=b("div"),c=b("input"),g=$(),h=b("div"),w=b("span"),y=x(B),z=$(),F=b("span"),k=x(_),A=$(),E=b("div"),G&&G.c(),T=$(),I=b("button"),C=x("🔗 "),R=x(j),N(o,"class","departure-label svelte-4szoo7"),N(s,"class","departure-time svelte-4szoo7"),N(n,"class","departure-header svelte-4szoo7"),N(c,"type","range"),N(c,"min",u=e[13].start),N(c,"max",p=e[13].end),N(c,"step",36e5),N(c,"class","slider svelte-4szoo7"),N(h,"class","timeline-labels svelte-4szoo7"),N(l,"class","timeline-slider svelte-4szoo7"),N(I,"class","btn-sync svelte-4szoo7"),N(I,"title",L=e[14]?"Synced with Windy timeline":"Click to sync with Windy timeline"),D(I,"active",e[14]),N(E,"class","departure-footer svelte-4szoo7"),N(t,"class","departure-section svelte-4szoo7")},m(d,u){v(d,t,u),f(t,n),f(n,o),f(n,i),f(n,s),f(s,r),f(t,a),f(t,l),f(l,c),S(c,e[12]),f(l,g),f(l,h),f(h,w),f(w,y),f(h,z),f(h,F),f(F,k),f(t,A),f(t,E),G&&G.m(E,null),f(E,T),f(E,I),f(I,C),f(I,R),V||(O=[M(c,"change",e[47]),M(c,"input",e[47]),M(c,"change",e[38]),M(I,"click",e[39])],V=!0)},p(e,t){4096&t[0]&&W!==(W=mi(e[12])+"")&&P(r,W),8192&t[0]&&u!==(u=e[13].start)&&N(c,"min",u),8192&t[0]&&p!==(p=e[13].end)&&N(c,"max",p),4096&t[0]&&S(c,e[12]),8192&t[0]&&B!==(B=wi(e[13].start)+"")&&P(y,B),8192&t[0]&&_!==(_=wi(e[13].end)+"")&&P(k,_),e[0]&&e[0].totals.ete>0?G?G.p(e,t):(G=Zo(e),G.c(),G.m(E,T)):G&&(G.d(1),G=null),16384&t[0]&&j!==(j=e[14]?"Synced":"Sync")&&P(R,j),16384&t[0]&&L!==(L=e[14]?"Synced with Windy timeline":"Click to sync with Windy timeline")&&N(I,"title",L),16384&t[0]&&D(I,"active",e[14])},d(e){e&&m(t),G&&G.d(),V=!1,d(O)}}}function Zo(e){let t,n,o,i=mi(e[12]+6e4*e[0].totals.ete)+"";return{c(){t=b("span"),n=x("ETA: "),o=x(i),N(t,"class","arrival-info svelte-4szoo7")},m(e,i){v(e,t,i),f(t,n),f(t,o)},p(e,t){4097&t[0]&&i!==(i=mi(e[12]+6e4*e[0].totals.ete)+"")&&P(o,i)},d(e){e&&m(t)}}}function Jo(e){let t,n,o,i,s,r,a,l,c,u,p,g,h,w,y=e[0].waypoints.length+"",z=Kt(e[0].totals.distance)+"",M=en(e[0].totals.ete)+"",F=[],k=new Co,S=void 0!==e[0].totals.averageHeadwind&&Ko(e),A=oe(e[0].waypoints);const D=e=>e[80].id;for(let t=0;t<A.length;t+=1){let n=Lo(e,A,t),o=D(n);k.set(o,F[t]=li(o,n))}return{c(){t=b("div"),n=b("div"),o=b("span"),i=x("Waypoints ("),s=x(y),r=x(")"),a=$(),l=b("span"),c=x(z),u=x(" · "),p=x(M),g=$(),S&&S.c(),h=$(),w=b("div");for(let e=0;e<F.length;e+=1)F[e].c();N(l,"class","totals svelte-4szoo7"),N(n,"class","section-header svelte-4szoo7"),N(w,"class","waypoint-table svelte-4szoo7"),N(t,"class","waypoint-section svelte-4szoo7")},m(e,d){v(e,t,d),f(t,n),f(n,o),f(o,i),f(o,s),f(o,r),f(n,a),f(n,l),f(l,c),f(l,u),f(l,p),f(l,g),S&&S.m(l,null),f(t,h),f(t,w);for(let e=0;e<F.length;e+=1)F[e]&&F[e].m(w,null)},p(e,t){1&t[0]&&y!==(y=e[0].waypoints.length+"")&&P(s,y),1&t[0]&&z!==(z=Kt(e[0].totals.distance)+"")&&P(c,z),1&t[0]&&M!==(M=en(e[0].totals.ete)+"")&&P(p,M),void 0!==e[0].totals.averageHeadwind?S?S.p(e,t):(S=Ko(e),S.c(),S.m(l,null)):S&&(S.d(1),S=null),486572035&t[0]|48&t[1]&&(A=oe(e[0].waypoints),F=function(e,t,n,o,i,s,r,a,l,c,u,p){let g=e.length,f=s.length,h=g;const v={};for(;h--;)v[e[h].key]=h;const m=[],w=new Map,b=new Map,y=[];for(h=f;h--;){const e=p(i,s,h),o=n(e);let a=r.get(o);a?y.push(()=>a.p(e,t)):(a=c(o,e),a.c()),w.set(o,m[h]=a),o in v&&b.set(o,Math.abs(h-v[o]))}const x=new Set,$=new Set;function z(e){te(e,1),e.m(a,u),r.set(e.key,e),u=e.first,f--}for(;g&&f;){const t=m[f-1],n=e[g-1],o=t.key,i=n.key;t===n?(u=t.first,g--,f--):w.has(i)?!r.has(o)||x.has(o)?z(t):$.has(i)?g--:b.get(o)>b.get(i)?($.add(o),z(t)):(x.add(i),g--):(l(n,r),g--)}for(;g--;){const t=e[g];w.has(t.key)||l(t,r)}for(;f;)z(m[f-1]);return d(y),m}(F,t,D,0,e,A,k,w,ie,li,null,Lo))},d(e){e&&m(t),S&&S.d();for(let e=0;e<F.length;e+=1)F[e].d()}}}function Ko(e){let t,n,o=tn(e[0].totals.averageHeadwind)+"";return{c(){t=x("· "),n=x(o)},m(e,o){v(e,t,o),v(e,n,o)},p(e,t){1&t[0]&&o!==(o=tn(e[0].totals.averageHeadwind)+"")&&P(n,o)},d(e){e&&(m(t),m(n))}}}function Qo(e){let t;return{c(){t=b("span"),t.textContent="⚠️",N(t,"class","alert-badge svelte-4szoo7"),D(t,"warning",e[82].some(bi))},m(e,n){v(e,t,n)},p(e,n){1&n[0]|32&n[1]&&D(t,"warning",e[82].some(bi))},d(e){e&&m(t)}}}function ei(e){let t,n,o=e[80].comment+"";return{c(){t=b("div"),n=x(o),N(t,"class","wp-comment svelte-4szoo7")},m(e,o){v(e,t,o),f(t,n)},p(e,t){1&t[0]&&o!==(o=e[80].comment+"")&&P(n,o)},d(e){e&&m(t)}}}function ti(e){let t,n,o,i,s,r,a,l,c,d,u,p,g,h,w,y,z=hn(e[81].windSpeed,e[81].windDir,e[81].windAltitude)+"",F=vn(e[81].temperature)+"",k=(e[81].cloudBaseDisplay??"N/A")+"",S=e[81].windLevel&&"surface"!==e[81].windLevel&&ni(e);function A(){return e[48](e[81],e[80])}return{c(){t=b("div"),n=b("span"),o=x("💨 "),i=x(z),S&&S.c(),r=$(),a=b("span"),l=x("🌡️ "),c=x(F),d=$(),u=b("span"),p=x("☁️ "),g=x(k),N(n,"class","wx-wind svelte-4szoo7"),N(n,"title",s=e[81].windAltitude?`Wind at ${Math.round(e[81].windAltitude)}ft (${e[81].windLevel||"surface"})`:"Surface wind"),N(a,"class","wx-temp svelte-4szoo7"),N(a,"title","Temperature"),N(u,"class","wx-cloud svelte-4szoo7"),N(u,"title",h=void 0!==e[81].cloudBase?"Click to view full cbase table in console":"Cloud base (ECMWF) - N/A"),D(u,"clickable",void 0!==e[81].cloudBase),N(t,"class","wp-weather svelte-4szoo7")},m(e,s){v(e,t,s),f(t,n),f(n,o),f(n,i),S&&S.m(n,null),f(t,r),f(t,a),f(a,l),f(a,c),f(t,d),f(t,u),f(u,p),f(u,g),w||(y=M(u,"click",A),w=!0)},p(t,o){e=t,1&o[0]&&z!==(z=hn(e[81].windSpeed,e[81].windDir,e[81].windAltitude)+"")&&P(i,z),e[81].windLevel&&"surface"!==e[81].windLevel?S?S.p(e,o):(S=ni(e),S.c(),S.m(n,null)):S&&(S.d(1),S=null),1&o[0]&&s!==(s=e[81].windAltitude?`Wind at ${Math.round(e[81].windAltitude)}ft (${e[81].windLevel||"surface"})`:"Surface wind")&&N(n,"title",s),1&o[0]&&F!==(F=vn(e[81].temperature)+"")&&P(c,F),1&o[0]&&k!==(k=(e[81].cloudBaseDisplay??"N/A")+"")&&P(g,k),1&o[0]&&h!==(h=void 0!==e[81].cloudBase?"Click to view full cbase table in console":"Cloud base (ECMWF) - N/A")&&N(u,"title",h),1&o[0]|16&o[1]&&D(u,"clickable",void 0!==e[81].cloudBase)},d(e){e&&m(t),S&&S.d(),w=!1,y()}}}function ni(e){let t,n,o,i,s=e[81].windLevel+"";return{c(){t=b("small"),n=x("("),o=x(s),i=x(")"),A(t,"opacity","0.7")},m(e,s){v(e,t,s),f(t,n),f(t,o),f(t,i)},p(e,t){1&t[0]&&s!==(s=e[81].windLevel+"")&&P(o,s)},d(e){e&&m(t)}}}function oi(e){let t,n,o;return{c(){t=b("div"),t.textContent="---",n=$(),o=b("div"),o.textContent="DEP",N(t,"class","wp-bearing svelte-4szoo7"),N(o,"class","wp-distance svelte-4szoo7")},m(e,i){v(e,t,i),v(e,n,i),v(e,o,i)},p:a,d(e){e&&(m(t),m(n),m(o))}}}function ii(e){let t,n,o,i,s,r,a,l=Qt(e[80].bearing||0)+"",c=Kt(e[80].distance||0)+"",d=e[80].groundSpeed&&si(e);return{c(){t=b("div"),n=x(l),o=$(),i=b("div"),s=x(c),r=$(),d&&d.c(),a=z(),N(t,"class","wp-bearing svelte-4szoo7"),N(i,"class","wp-distance svelte-4szoo7")},m(e,l){v(e,t,l),f(t,n),v(e,o,l),v(e,i,l),f(i,s),v(e,r,l),d&&d.m(e,l),v(e,a,l)},p(e,t){1&t[0]&&l!==(l=Qt(e[80].bearing||0)+"")&&P(n,l),1&t[0]&&c!==(c=Kt(e[80].distance||0)+"")&&P(s,c),e[80].groundSpeed?d?d.p(e,t):(d=si(e),d.c(),d.m(a.parentNode,a)):d&&(d.d(1),d=null)},d(e){e&&(m(t),m(o),m(i),m(r),m(a)),d&&d.d(e)}}}function si(e){let t,n,o,i=Math.round(e[80].groundSpeed)+"";return{c(){t=b("div"),n=x("GS "),o=x(i),N(t,"class","wp-gs svelte-4szoo7"),N(t,"title","Ground speed")},m(e,i){v(e,t,i),f(t,n),f(t,o)},p(e,t){1&t[0]&&i!==(i=Math.round(e[80].groundSpeed)+"")&&P(o,i)},d(e){e&&m(t)}}}function ri(e){let t,n,o=oe(e[82]),i=[];for(let t=0;t<o.length;t+=1)i[t]=ai(Vo(e,o,t));return{c(){t=b("div");for(let e=0;e<i.length;e+=1)i[e].c();n=$(),N(t,"class","alert-row svelte-4szoo7")},m(e,o){v(e,t,o);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(t,null);f(t,n)},p(e,s){if(1&s[0]|32&s[1]){let r;for(o=oe(e[82]),r=0;r<o.length;r+=1){const a=Vo(e,o,r);i[r]?i[r].p(a,s):(i[r]=ai(a),i[r].c(),i[r].m(t,n))}for(;r<i.length;r+=1)i[r].d(1);i.length=o.length}},d(e){e&&m(t),w(i,e)}}}function ai(e){let t,n,o=e[85].message+"";return{c(){t=b("span"),n=x(o),N(t,"class","alert-item svelte-4szoo7"),D(t,"warning","warning"===e[85].severity)},m(e,o){v(e,t,o),f(t,n)},p(e,i){1&i[0]&&o!==(o=e[85].message+"")&&P(n,o),1&i[0]|32&i[1]&&D(t,"warning","warning"===e[85].severity)},d(e){e&&m(t)}}}function li(e,t){let n,o,i,s,r,a,l,c,u,p,g,h,w,y,k,S,A,E,T,I,C,R,L,V,O,W,B,_,j,G,U=t[84]+1+"",q=hi(t[80].type)+"",X=t[80].name+"",H=t[82].length>0&&Qo(t),Y=t[80].comment&&ei(t),Z=t[81]&&ti(t);function J(e,t){return e[84]>0?ii:oi}let K=J(t),Q=K(t);function ee(){return t[49](t[80])}function te(){return t[50](t[80])}function ne(){return t[51](t[80])}function oe(){return t[52](t[80])}let ie=t[82].length>0&&ri(t);return{key:e,first:null,c(){n=b("div"),o=b("div"),i=x(U),s=$(),r=b("div"),a=b("div"),l=b("span"),c=x(q),u=$(),p=x(X),g=$(),H&&H.c(),h=$(),Y&&Y.c(),w=$(),Z&&Z.c(),y=$(),k=b("div"),Q.c(),S=$(),A=b("div"),E=b("button"),T=x("▲"),C=$(),R=b("button"),L=x("▼"),O=$(),W=b("button"),W.textContent="🗑",B=$(),ie&&ie.c(),_=z(),N(o,"class","wp-index svelte-4szoo7"),N(l,"class","wp-type-icon svelte-4szoo7"),N(a,"class","wp-name svelte-4szoo7"),N(r,"class","wp-info svelte-4szoo7"),N(k,"class","wp-nav svelte-4szoo7"),N(E,"class","btn-move svelte-4szoo7"),N(E,"title","Move up"),E.disabled=I=0===t[84],N(R,"class","btn-move svelte-4szoo7"),N(R,"title","Move down"),R.disabled=V=t[84]===t[0].waypoints.length-1,N(W,"class","btn-delete svelte-4szoo7"),N(W,"title","Delete waypoint"),N(A,"class","wp-actions svelte-4szoo7"),N(n,"class","waypoint-row svelte-4szoo7"),D(n,"selected",t[1]===t[80].id),D(n,"has-warning",t[82].some(yi)),D(n,"has-caution",t[82].some(xi)),this.first=n},m(e,t){v(e,n,t),f(n,o),f(o,i),f(n,s),f(n,r),f(r,a),f(a,l),f(l,c),f(a,u),f(a,p),f(a,g),H&&H.m(a,null),f(r,h),Y&&Y.m(r,null),f(r,w),Z&&Z.m(r,null),f(n,y),f(n,k),Q.m(k,null),f(n,S),f(n,A),f(A,E),f(E,T),f(A,C),f(A,R),f(R,L),f(A,O),f(A,W),v(e,B,t),ie&&ie.m(e,t),v(e,_,t),j||(G=[M(E,"click",F(ee)),M(R,"click",F(te)),M(W,"click",F(ne)),M(n,"click",oe)],j=!0)},p(e,o){t=e,1&o[0]&&U!==(U=t[84]+1+"")&&P(i,U),1&o[0]&&q!==(q=hi(t[80].type)+"")&&P(c,q),1&o[0]&&X!==(X=t[80].name+"")&&P(p,X),t[82].length>0?H?H.p(t,o):(H=Qo(t),H.c(),H.m(a,null)):H&&(H.d(1),H=null),t[80].comment?Y?Y.p(t,o):(Y=ei(t),Y.c(),Y.m(r,w)):Y&&(Y.d(1),Y=null),t[81]?Z?Z.p(t,o):(Z=ti(t),Z.c(),Z.m(r,null)):Z&&(Z.d(1),Z=null),K===(K=J(t))&&Q?Q.p(t,o):(Q.d(1),Q=K(t),Q&&(Q.c(),Q.m(k,null))),1&o[0]&&I!==(I=0===t[84])&&(E.disabled=I),1&o[0]&&V!==(V=t[84]===t[0].waypoints.length-1)&&(R.disabled=V),3&o[0]&&D(n,"selected",t[1]===t[80].id),1&o[0]|32&o[1]&&D(n,"has-warning",t[82].some(yi)),1&o[0]|32&o[1]&&D(n,"has-caution",t[82].some(xi)),t[82].length>0?ie?ie.p(t,o):(ie=ri(t),ie.c(),ie.m(_.parentNode,_)):ie&&(ie.d(1),ie=null)},d(e){e&&(m(n),m(B),m(_)),H&&H.d(),Y&&Y.d(),Z&&Z.d(),Q.d(),ie&&ie.d(e),j=!1,d(G)}}}function ci(e){let t,n,o,i;const s=[ui,di],r=[];function a(e,t){return 0===e[8].size?0:1}return t=a(e),n=r[t]=s[t](e),{c(){n.c(),o=z()},m(e,n){r[t].m(e,n),v(e,o,n),i=!0},p(e,i){let l=t;t=a(e),t===l?r[t].p(e,i):(Q(),ne(r[l],1,1,()=>{r[l]=null}),ee(),n=r[t],n?n.p(e,i):(n=r[t]=s[t](e),n.c()),te(n,1),n.m(o.parentNode,o))},i(e){i||(te(n),i=!0)},o(e){ne(n),i=!1},d(e){e&&m(o),r[t].d(e)}}}function di(e){let t,n;return t=new Io({props:{flightPlan:e[0],weatherData:e[8],elevationProfile:e[11],settings:e[15],maxAltitude:e[16],scale:e[17]}}),t.$on("waypointClick",e[53]),{c(){var e;(e=t.$$.fragment)&&e.c()},m(e,o){se(t,e,o),n=!0},p(e,n){const o={};1&n[0]&&(o.flightPlan=e[0]),256&n[0]&&(o.weatherData=e[8]),2048&n[0]&&(o.elevationProfile=e[11]),32768&n[0]&&(o.settings=e[15]),65536&n[0]&&(o.maxAltitude=e[16]),131072&n[0]&&(o.scale=e[17]),t.$set(o)},i(e){n||(te(t.$$.fragment,e),n=!0)},o(e){ne(t.$$.fragment,e),n=!1},d(e){re(t,e)}}}function ui(e){let t;return{c(){t=b("div"),t.innerHTML='<p class="svelte-4szoo7">Please click &quot;Read Wx&quot; to fetch weather data before viewing the profile.</p>',N(t,"class","profile-empty svelte-4szoo7")},m(e,n){v(e,t,n)},p:a,i:a,o:a,d(e){e&&m(t)}}}function pi(e){let t,n,o,i,s,r,a,l,c,u,p,g,h,w,y,z,F,A,D,E,T,I,C,R,L,V,O,W,B,_,j,G,U,q,X,H,Y,Z,J,K,Q,ee,te,ne,oe,ie,se,re,ae,le,ce,de,ue,pe,ge,fe,he,ve,me,we,be,ye,xe,$e,ze,Me=e[15].terrainSampleInterval+"",Fe=Math.ceil((e[0].totals.distance||0)/e[15].terrainSampleInterval)+e[0].waypoints.length+"",Ne=e[15].allowDrag?"Drag markers on map to reposition waypoints":"Enable dragging to reposition waypoints";return{c(){t=b("div"),n=b("div"),o=b("label"),o.textContent="Default Airspeed (TAS)",i=$(),s=b("div"),r=b("input"),a=$(),l=b("span"),l.textContent="kt",c=$(),u=b("div"),p=b("label"),p.textContent="Default Altitude",g=$(),h=b("div"),w=b("input"),y=$(),z=b("span"),z.textContent="ft",F=$(),A=b("div"),D=b("label"),E=b("input"),T=x("\n                    Allow waypoint dragging"),I=$(),C=b("div"),R=b("label"),L=b("input"),V=x("\n                    Show waypoint labels on map"),O=$(),W=b("div"),B=b("label"),B.textContent="Terrain Sample Interval",_=$(),j=b("div"),G=b("input"),U=$(),q=b("span"),q.textContent="NM",X=$(),H=b("div"),Y=x("Distance between terrain elevation samples. Lower = more detail, but slower.\n                    "),Z=b("br"),J=x("Current: "),K=x(Me),Q=x(" NM interval will fetch ~"),ee=x(Fe),te=x(" elevation points"),ne=$(),oe=b("div"),ie=b("label"),ie.textContent="Profile Top Height",se=$(),re=b("div"),ae=b("input"),le=$(),ce=b("span"),ce.textContent="ft MSL",de=$(),ue=b("div"),ue.textContent="Maximum altitude displayed on the altitude profile graph.",pe=$(),ge=b("div"),fe=b("label"),he=b("input"),ve=x("\n                    Enable debug logging"),me=$(),we=b("div"),be=b("p"),ye=x("Tip: "),xe=x(Ne),N(o,"class","setting-label svelte-4szoo7"),N(r,"type","number"),N(r,"min","50"),N(r,"max","500"),N(r,"class","svelte-4szoo7"),N(l,"class","unit svelte-4szoo7"),N(s,"class","setting-input svelte-4szoo7"),N(n,"class","setting-group svelte-4szoo7"),N(p,"class","setting-label svelte-4szoo7"),N(w,"type","number"),N(w,"min","0"),N(w,"max","45000"),N(w,"step","500"),N(w,"class","svelte-4szoo7"),N(z,"class","unit svelte-4szoo7"),N(h,"class","setting-input svelte-4szoo7"),N(u,"class","setting-group svelte-4szoo7"),N(E,"type","checkbox"),N(E,"class","svelte-4szoo7"),N(D,"class","setting-checkbox svelte-4szoo7"),N(A,"class","setting-group svelte-4szoo7"),N(L,"type","checkbox"),N(L,"class","svelte-4szoo7"),N(R,"class","setting-checkbox svelte-4szoo7"),N(C,"class","setting-group svelte-4szoo7"),N(B,"class","setting-label svelte-4szoo7"),N(G,"type","number"),N(G,"min","1"),N(G,"max","10"),N(G,"step","0.5"),N(G,"class","svelte-4szoo7"),N(q,"class","unit svelte-4szoo7"),N(j,"class","setting-input svelte-4szoo7"),N(H,"class","setting-description svelte-4szoo7"),N(W,"class","setting-group svelte-4szoo7"),N(ie,"class","setting-label svelte-4szoo7"),N(ae,"type","number"),N(ae,"min","1000"),N(ae,"max","60000"),N(ae,"step","1000"),N(ae,"class","svelte-4szoo7"),N(ce,"class","unit svelte-4szoo7"),N(re,"class","setting-input svelte-4szoo7"),N(ue,"class","setting-description svelte-4szoo7"),N(oe,"class","setting-group svelte-4szoo7"),N(he,"type","checkbox"),N(he,"class","svelte-4szoo7"),N(fe,"class","setting-checkbox svelte-4szoo7"),N(ge,"class","setting-group svelte-4szoo7"),N(be,"class","svelte-4szoo7"),N(we,"class","setting-info svelte-4szoo7"),N(t,"class","settings-section svelte-4szoo7")},m(d,m){v(d,t,m),f(t,n),f(n,o),f(n,i),f(n,s),f(s,r),S(r,e[15].defaultAirspeed),f(s,a),f(s,l),f(t,c),f(t,u),f(u,p),f(u,g),f(u,h),f(h,w),S(w,e[15].defaultAltitude),f(h,y),f(h,z),f(t,F),f(t,A),f(A,D),f(D,E),E.checked=e[15].allowDrag,f(D,T),f(t,I),f(t,C),f(C,R),f(R,L),L.checked=e[15].showLabels,f(R,V),f(t,O),f(t,W),f(W,B),f(W,_),f(W,j),f(j,G),S(G,e[15].terrainSampleInterval),f(j,U),f(j,q),f(W,X),f(W,H),f(H,Y),f(H,Z),f(H,J),f(H,K),f(H,Q),f(H,ee),f(H,te),f(t,ne),f(t,oe),f(oe,ie),f(oe,se),f(oe,re),f(re,ae),S(ae,e[16]),f(re,le),f(re,ce),f(oe,de),f(oe,ue),f(t,pe),f(t,ge),f(ge,fe),f(fe,he),he.checked=e[15].enableLogging,f(fe,ve),f(t,me),f(t,we),f(we,be),f(be,ye),f(be,xe),$e||(ze=[M(r,"input",e[54]),M(r,"change",e[30]),M(w,"input",e[55]),M(w,"change",e[30]),M(E,"change",e[56]),M(E,"change",e[30]),M(L,"change",e[57]),M(L,"change",e[30]),M(G,"input",e[58]),M(G,"change",e[30]),M(ae,"input",e[59]),M(he,"change",e[60]),M(he,"change",e[30])],$e=!0)},p(e,t){32768&t[0]&&k(r.value)!==e[15].defaultAirspeed&&S(r,e[15].defaultAirspeed),32768&t[0]&&k(w.value)!==e[15].defaultAltitude&&S(w,e[15].defaultAltitude),32768&t[0]&&(E.checked=e[15].allowDrag),32768&t[0]&&(L.checked=e[15].showLabels),32768&t[0]&&k(G.value)!==e[15].terrainSampleInterval&&S(G,e[15].terrainSampleInterval),32768&t[0]&&Me!==(Me=e[15].terrainSampleInterval+"")&&P(K,Me),32769&t[0]&&Fe!==(Fe=Math.ceil((e[0].totals.distance||0)/e[15].terrainSampleInterval)+e[0].waypoints.length+"")&&P(ee,Fe),65536&t[0]&&k(ae.value)!==e[16]&&S(ae,e[16]),32768&t[0]&&(he.checked=e[15].enableLogging),32768&t[0]&&Ne!==(Ne=e[15].allowDrag?"Drag markers on map to reposition waypoints":"Enable dragging to reposition waypoints")&&P(xe,Ne)},d(e){e&&m(t),$e=!1,d(ze)}}}function gi(e){let t,n,o,i,s,r,a,l,c,u,p,g,h,w,y,x,z,F=e[0]&&Oo(e);function k(e,t){return e[2]?_o:e[0]?Wo:Bo}let P=k(e),S=P(e),E=e[4]&&jo(e),T="route"===e[6]&&Go(e),I="profile"===e[6]&&e[0]&&e[0].waypoints.length>=2&&ci(e),C="settings"===e[6]&&e[0]&&pi(e);return{c(){t=b("div"),t.textContent=`${e[18]}`,n=$(),o=b("section"),i=b("div"),i.textContent=`${e[18]}`,s=$(),F&&F.c(),r=$(),a=b("div"),l=b("div"),c=b("input"),u=$(),S.c(),p=$(),E&&E.c(),g=$(),T&&T.c(),h=$(),I&&I.c(),w=$(),C&&C.c(),N(t,"class","plugin__mobile-header"),N(i,"class","plugin__title plugin__title--chevron-back"),N(c,"type","file"),N(c,"accept",".fpl,.xml"),A(c,"display","none"),N(l,"class","drop-zone svelte-4szoo7"),D(l,"drag-over",e[3]),N(a,"class","import-section svelte-4szoo7"),N(o,"class","plugin__content")},m(d,m){v(d,t,m),v(d,n,m),v(d,o,m),f(o,i),f(o,s),F&&F.m(o,null),f(o,r),f(o,a),f(a,l),f(l,c),e[45](c),f(l,u),S.m(l,null),f(a,p),E&&E.m(a,null),f(o,g),T&&T.m(o,null),f(o,h),I&&I.m(o,null),f(o,w),C&&C.m(o,null),y=!0,x||(z=[M(i,"click",e[41]),M(c,"change",e[22]),M(l,"dragover",e[19]),M(l,"dragleave",e[20]),M(l,"drop",e[21])],x=!0)},p(e,t){e[0]?F?F.p(e,t):(F=Oo(e),F.c(),F.m(o,r)):F&&(F.d(1),F=null),P===(P=k(e))&&S?S.p(e,t):(S.d(1),S=P(e),S&&(S.c(),S.m(l,null))),(!y||8&t[0])&&D(l,"drag-over",e[3]),e[4]?E?E.p(e,t):(E=jo(e),E.c(),E.m(a,null)):E&&(E.d(1),E=null),"route"===e[6]?T?T.p(e,t):(T=Go(e),T.c(),T.m(o,h)):T&&(T.d(1),T=null),"profile"===e[6]&&e[0]&&e[0].waypoints.length>=2?I?(I.p(e,t),65&t[0]&&te(I,1)):(I=ci(e),I.c(),te(I,1),I.m(o,w)):I&&(Q(),ne(I,1,1,()=>{I=null}),ee()),"settings"===e[6]&&e[0]?C?C.p(e,t):(C=pi(e),C.c(),C.m(o,null)):C&&(C.d(1),C=null)},i(e){y||(te(I),y=!0)},o(e){ne(I),y=!1},d(i){i&&(m(t),m(n),m(o)),F&&F.d(),e[45](null),S.d(),E&&E.d(),T&&T.d(),I&&I.d(),C&&C.d(),x=!1,d(z)}}}function fi(e){switch(e){case"good":return"#4caf50";case"marginal":return"#ff9800";case"poor":return"#f44336";default:return"#757575"}}function hi(e){switch(e){case"AIRPORT":return"🛫";case"VOR":return"📡";case"NDB":return"📻";case"INT":case"INT-VRP":return"📍";default:return"📌"}}function vi(e){switch(e){case"AIRPORT":return"#e74c3c";case"VOR":return"#3498db";case"NDB":return"#9b59b6";case"INT":case"INT-VRP":return"#2ecc71";default:return"#f39c12"}}function mi(e){const t=new Date(e),n=new Date,o=t.toDateString()===n.toDateString(),i=new Date(n);i.setDate(i.getDate()+1);const s=t.toDateString()===i.toDateString(),r=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(o)return`Today ${r}`;if(s)return`Tomorrow ${r}`;return`${t.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})} ${r}`}function wi(e){const t=new Date(e),n=new Date;return t.toDateString()===n.toDateString()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})}const bi=e=>"warning"===e.severity,yi=e=>"warning"===e.severity,xi=e=>"caution"===e.severity;function $i(e,r,a){const{name:l,title:c}=ce,d=`vfr-planner-session-${l}`;let u,p=null,g=null,f=!1,h=!1,v=null,m="route",w=!1,b=new Map,y=new Map,x=!1,$=null,z=[],M=Date.now(),F=null,N=!0,P=!1,S=!1,A={...Pn},D=15e3,E=511,T=null,C=null,R=new Map;async function O(e){a(4,v=null),a(2,f=!0);try{const t=await Vt(e);if(!t.success||!t.flightPlan)return a(4,v=t.error||"Failed to parse file"),void a(2,f=!1);const n=function(e){const t=[];e.waypointTable&&0!==e.waypointTable.length||t.push({field:"waypointTable",message:"Flight plan must contain at least one waypoint"});for(let n=0;n<e.waypointTable.length;n++){const o=e.waypointTable[n];o.identifier&&0!==o.identifier.length?o.identifier.length>12&&t.push({field:`waypointTable[${n}].identifier`,message:"Waypoint identifier must be 12 characters or less",value:o.identifier}):t.push({field:`waypointTable[${n}].identifier`,message:"Waypoint identifier is required"}),(o.lat<-90||o.lat>90)&&t.push({field:`waypointTable[${n}].lat`,message:"Latitude must be between -90 and 90",value:o.lat}),(o.lon<-180||o.lon>180)&&t.push({field:`waypointTable[${n}].lon`,message:"Longitude must be between -180 and 180",value:o.lon})}if(e.route){const n=new Set(e.waypointTable.map(e=>e.identifier));for(let o=0;o<e.route.points.length;o++){const i=e.route.points[o];n.has(i.waypointIdentifier)||t.push({field:`route.points[${o}].waypointIdentifier`,message:`Route point references unknown waypoint: ${i.waypointIdentifier}`,value:i.waypointIdentifier})}}return{valid:0===t.length,errors:t}}(t.flightPlan);if(!n.valid)return a(4,v=n.errors.map(e=>e.message).join(", ")),void a(2,f=!1);let o=function(e,t){const n=new Map;for(const t of e.waypointTable)n.set(t.identifier,t);let o;o=e.route&&e.route.points.length>0?e.route.points.map(e=>n.get(e.waypointIdentifier)).filter(e=>void 0!==e):e.waypointTable;const i=o.map((e,t)=>({id:Lt(e.identifier,t),name:e.identifier,type:e.type,lat:e.lat,lon:e.lon,comment:e.comment,elevation:e.elevation})),s=e.route?.name||(i.length>=2?`${i[0].name} to ${i[i.length-1].name}`:"Unnamed Flight Plan");return{id:`fp-${Date.now()}`,name:s,waypoints:i,aircraft:{airspeed:100,defaultAltitude:3e3},totals:{distance:0,ete:0},sourceFile:t,sourceFormat:"fpl"}}(t.flightPlan,e.name);o.aircraft.airspeed=A.defaultAirspeed,o.aircraft.defaultAltitude=A.defaultAltitude;const i=Jt(o.waypoints,o.aircraft.airspeed);o={...o,waypoints:i.waypoints,totals:i.totals},a(0,p=o),K(),ee(),te()}catch(e){a(4,v=e instanceof Error?e.message:"Unknown error")}finally{a(2,f=!1)}}function W(){a(0,p=null),a(1,g=null),a(4,v=null),a(7,w=!1),a(6,m="route"),a(8,b=new Map),y=new Map,a(10,$=null),a(13,F=null),a(12,M=Date.now()),Q(),te()}function B(e){a(1,g=e.id),n.panTo([e.lat,e.lon])}function _(e){if(!p)return;const t=p.waypoints.find(t=>t.id===e);t&&(B(t),a(6,m="route"))}async function j(e,t,n){if(!p)return;const o={id:`wp_${Date.now()}`,name:`WP${p.waypoints.length+1}`,type:"user",lat:t,lon:n,altitude:p.aircraft.defaultAltitude},i=Jt([...p.waypoints.slice(0,e+1),o,...p.waypoints.slice(e+1)],p.aircraft.airspeed);a(0,p={...p,waypoints:i.waypoints,totals:i.totals}),await U(),A.enableLogging&&console.log("[VFR Planner] Inserted waypoint:",o.name,"at",e+1,"Total waypoints:",p.waypoints.length),A.enableLogging&&console.log("[VFR Planner] Scheduling updateMapLayers via requestAnimationFrame"),requestAnimationFrame(()=>{A.enableLogging&&console.log("[VFR Planner] requestAnimationFrame callback executing"),K()}),te(),a(1,g=o.id)}async function G(e){if(!p)return;const t=p.waypoints.findIndex(t=>t.id===e);if(t<=0)return;const n=[...p.waypoints],o=n[t-1];n[t-1]=n[t],n[t]=o;const i=Jt(n,p.aircraft.airspeed);a(0,p={...p,waypoints:i.waypoints,totals:i.totals}),await U(),A.enableLogging&&console.log("[VFR Planner] Moved waypoint up:",n[t-1].name),A.enableLogging&&console.log("[VFR Planner] Scheduling updateMapLayers via requestAnimationFrame"),requestAnimationFrame(()=>{A.enableLogging&&console.log("[VFR Planner] requestAnimationFrame callback executing"),K()}),te()}async function q(e){if(!p)return;const t=p.waypoints.findIndex(t=>t.id===e);if(t<0||t>=p.waypoints.length-1)return;const n=[...p.waypoints],o=n[t];n[t]=n[t+1],n[t+1]=o;const i=Jt(n,p.aircraft.airspeed);a(0,p={...p,waypoints:i.waypoints,totals:i.totals}),await U(),A.enableLogging&&console.log("[VFR Planner] Moved waypoint down:",n[t+1].name),A.enableLogging&&console.log("[VFR Planner] Scheduling updateMapLayers via requestAnimationFrame"),requestAnimationFrame(()=>{A.enableLogging&&console.log("[VFR Planner] requestAnimationFrame callback executing"),K()}),te()}function X(e){if(!p)return;const t=p.waypoints.filter(t=>t.id!==e);if(0===t.length)return void W();const n=Jt(t,A.defaultAirspeed);a(0,p={...p,waypoints:n.waypoints,totals:n.totals}),g===e&&a(1,g=null),K(),te()}function H(e){if(!w||!p)return;const{lat:t,lon:n}=e,o={id:`wp-${Date.now()}`,name:`WPT${p.waypoints.length+1}`,type:"USER WAYPOINT",lat:t,lon:n},i=Jt([...p.waypoints,o],A.defaultAirspeed);a(0,p={...p,waypoints:i.waypoints,totals:i.totals}),a(7,w=!1),K(),te()}async function Y(){if(p){a(9,x=!0),a(10,$=null);try{if(!F&&p.waypoints.length>0){const e=p.waypoints[0];if(a(13,F=await async function(e,t){try{const n=i.get("product")||"ecmwf",o=s(n,{lat:e,lon:t},{},{}),r=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Forecast time range fetch timeout"))},1e4)}),a=await Promise.race([o,r]),{data:l}=a.data,c=l.ts;return c&&0!==c.length?{start:c[0],end:c[c.length-1],timestamps:c}:null}catch(e){return console.error("Failed to get forecast time range:",e),null}}(e.lat,e.lon)),F)if(N){const e=i.get("timestamp");if(e)a(12,M=Math.max(F.start,Math.min(e,F.end)));else{const e=Date.now();a(12,M=Math.max(F.start,Math.min(e,F.end)))}}else{const e=Date.now();a(12,M=Math.max(F.start,Math.min(e,F.end)))}}const e=p.aircraft.defaultAltitude,t=async function(e,t,n,o,i=!1){const s=new Map;let r=0;const a=e.map(async(e,t)=>{try{let t;n&&(t=n+60*r*1e3),r+=e.ete||0;const a=fn(e.lat,e.lon,0,t,e.name,o,i),l=new Promise(t=>{setTimeout(()=>{i&&console.warn(`[VFR] Weather fetch timeout for waypoint ${e.name} (${e.id})`),t(null)},15e3)}),c=await Promise.race([a,l]);c&&s.set(e.id,c)}catch(t){i&&console.error(`[VFR] Error fetching weather for waypoint ${e.name} (${e.id}):`,t)}});return await Promise.allSettled(a),s}(p.waypoints,0,M,e,A.enableLogging),n=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Weather fetch operation timed out after 60 seconds"))},6e4)});a(8,b=await Promise.race([t,n])),console.log(`[VFR Debug] Weather fetch complete: ${b.size} waypoints with weather data`),b.size>0&&(console.log("[VFR Debug] Weather data keys:",Array.from(b.keys())),b.forEach((e,t)=>{const n=p?.waypoints.find(e=>e.id===t);console.log(`[VFR Debug] Weather for ${n?.name||t}:`,{wind:`${Math.round(e.windDir)}° @ ${Math.round(e.windSpeed)} kt`,gust:e.windGust?`${Math.round(e.windGust)} kt`:"none",temp:`${Math.round(e.temperature)}°C`,cloudBase:e.cloudBase?`${Math.round(e.cloudBase)}m AGL`:"clear",visibility:e.visibility?`${e.visibility.toFixed(1)} km`:"N/A",pressure:e.pressure?`${Math.round(e.pressure)} hPa`:"N/A",windAltitude:e.windAltitude?`${e.windAltitude} ft`:"surface"})})),y=new Map,b.forEach((t,n)=>{const o=function(e,t=rn,n){const o=[];if(e.windSpeed>=t.windSpeed&&o.push({type:"wind",severity:e.windSpeed>=1.5*t.windSpeed?"warning":"caution",message:`Wind ${Math.round(e.windSpeed)} kt`,value:e.windSpeed,threshold:t.windSpeed}),e.windGust&&e.windGust>=t.gustSpeed&&o.push({type:"gust",severity:e.windGust>=1.3*t.gustSpeed?"warning":"caution",message:`Gust ${Math.round(e.windGust)} kt`,value:e.windGust,threshold:t.gustSpeed}),e.visibility&&e.visibility<t.visibility&&o.push({type:"visibility",severity:e.visibility<t.visibility/2?"warning":"caution",message:`Vis ${e.visibility.toFixed(1)} km`,value:e.visibility,threshold:t.visibility}),e.cloudBase){const i=cn(e.cloudBase),s=`${Math.round(i)} ft`;if(i<t.cloudBase&&o.push({type:"ceiling",severity:i<t.cloudBase/2?"warning":"caution",message:`Ceiling ${s}`,value:i,threshold:t.cloudBase}),void 0!==n&&n>0&&i<n){const e=n-i,t=`${Math.round(n)} ft`;o.push({type:"altitude-conflict",severity:e>500?"warning":"caution",message:`Ceiling ${s} below planned ${t}`,value:i,threshold:n})}}return e.precipitation&&e.precipitation>=t.precipitation&&o.push({type:"rain",severity:e.precipitation>=2*t.precipitation?"warning":"caution",message:`Rain ${e.precipitation.toFixed(1)} mm`,value:e.precipitation,threshold:t.precipitation}),o}(t,rn,e);o.length>0&&y.set(n,o)});try{A.enableLogging&&console.log(`[VFR Planner] Fetching terrain elevation profile from Open-Meteo (sampling every ${A.terrainSampleInterval} NM)...`),a(11,z=await kn(p.waypoints,A.terrainSampleInterval,A.enableLogging)),A.enableLogging&&console.log(`[VFR Planner] Terrain profile: ${z.length} elevation points`)}catch(e){console.error("[VFR Planner] Error fetching elevation profile:",e),a(11,z=[])}!function(){if(!p)return;const e=p.waypoints.map((e,t)=>{if(0===t)return e;p.waypoints[t-1];const n=b.get(e.id);if(n&&void 0!==e.bearing){const t=Zt(A.defaultAirspeed,e.bearing,n.windDir,n.windSpeed),o=e.distance||0,i=t>0?o/t*60:0;return{...e,groundSpeed:t,ete:i}}return e}),t=e.reduce((e,t)=>e+(t.ete||0),0),n=e.reduce((e,t)=>e+(t.distance||0),0);let o=0;e.forEach((e,t)=>{if(0===t)return;const n=b.get(e.id);if(n&&void 0!==e.bearing&&e.distance){const t=Yt(e.bearing,n.windDir,n.windSpeed);o+=t*e.distance}});const i=n>0?o/n:void 0;a(0,p={...p,waypoints:e,totals:{...p.totals,ete:t,averageHeadwind:i}})}(),K()}catch(e){a(10,$=e instanceof Error?e.message:"Failed to fetch weather"),console.error("[VFR Planner] Error fetching weather:",e),b&&0!==b.size||a(8,b=new Map)}finally{a(9,x=!1)}}}function Z(e){return b.get(e)}function J(e){if(!N||!F||x||S)return;const t=Math.max(F.start,Math.min(e,F.end));Math.abs(t-M)>5e3&&(P=!0,a(12,M=t),Y().finally(()=>{P=!1}))}function K(){if(A.enableLogging&&(console.log("[VFR Planner] updateMapLayers called, waypoints:",p?.waypoints.length),console.log("[VFR Planner] routeLayer exists:",!!T,"waypointMarkers exists:",!!C)),Q(),A.enableLogging&&console.log("[VFR Planner] After clearMapLayers: routeLayer:",!!T,"waypointMarkers:",!!C),!p||0===p.waypoints.length)return;const e=Mn(p.waypoints,b,p.aircraft.defaultAltitude,z);T=new L.LayerGroup;for(let t=0;t<p.waypoints.length-1;t++){const o=p.waypoints[t],i=p.waypoints[t+1],s=e[t]?.condition,r=[[o.lat,o.lon],[i.lat,i.lon]],a=fi(s),l=new L.Polyline(r,{color:a,weight:4,opacity:.8});l.on("click",e=>{A.allowDrag&&(L.DomEvent.stopPropagation(e),j(t,e.latlng.lat,e.latlng.lng))}),l.on("mouseover",()=>{A.allowDrag&&(n.getContainer().style.cursor="crosshair")}),l.on("mouseout",()=>{n.getContainer().style.cursor=""}),T.addLayer(l)}n.addLayer(T),A.enableLogging&&console.log("[VFR Planner] Added routeLayer to map with",p.waypoints.length-1,"segments"),C=new L.LayerGroup,R.clear(),p.waypoints.forEach((t,n)=>{let o;A.allowDrag?(o=new L.Marker([t.lat,t.lon],{draggable:!0,icon:L.divIcon({className:"wp-marker",html:`<div style="\n                            width: 16px;\n                            height: 16px;\n                            border-radius: 50%;\n                            background: ${vi(t.type)};\n                            border: 2px solid white;\n                            box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n                        "></div>`,iconSize:[16,16],iconAnchor:[8,8]})}),o.on("dragend",e=>{const n=e.target.getLatLng();!function(e,t,n){if(!p||!A.allowDrag)return;const o=Jt(p.waypoints.map(o=>o.id===e?{...o,lat:t,lon:n}:o),A.defaultAirspeed);a(0,p={...p,waypoints:o.waypoints,totals:o.totals}),K(),te()}(t.id,n.lat,n.lng)}),R.set(t.id,o)):o=new L.CircleMarker([t.lat,t.lon],{radius:8,fillColor:vi(t.type),color:"#fff",weight:2,opacity:1,fillOpacity:.8});let i=`<b>${n+1}. ${t.name}</b>${t.comment?`<br/><i>${t.comment}</i>`:""}`;const s=t.altitude??p.aircraft.defaultAltitude;i+='<br/><div style="margin-top: 2px; font-size: 11px;">',i+=`✈️ Altitude: ${Math.round(s)} ft MSL`;const r=e[n];if(void 0!==r?.terrainElevation){const e=s-r.terrainElevation;i+=` | ⛰️ Terrain: ${Math.round(r.terrainElevation)} ft`,i+=` (${e>=0?"+":""}${Math.round(e)} ft)`}i+="</div>";const l=Z(t.id);if(l&&(i+='<br/><div style="margin-top: 4px;">',i+=`💨 ${hn(l.windSpeed,l.windDir,l.windAltitude)}`,l.windLevel&&"surface"!==l.windLevel&&(i+=` <span style="font-size: 9px; color: #888;">(${l.windLevel})</span>`),i+=` | 🌡️ ${vn(l.temperature)}`,i+=` | ☁️ ${l.cloudBaseDisplay??"N/A"}`,i+="</div>",l.verticalWinds&&l.verticalWinds.length>0)){i+='<div style="margin-top: 6px; padding-top: 4px; border-top: 1px solid #444; font-size: 10px;">',i+="<b>📊 Winds Aloft:</b><br/>",i+='<table style="font-size: 10px; line-height: 1.3; margin-top: 2px;">';[...l.verticalWinds].sort((e,t)=>t.altitudeFeet-e.altitudeFeet).forEach(e=>{const t=l.windLevel?.includes(e.level);i+=`<tr${t?' style="color: #4CAF50; font-weight: bold;"':""}>`,i+=`<td style="padding-right: 8px;">${e.level}</td>`,i+=`<td style="padding-right: 4px; text-align: right;">${Math.round(e.altitudeFeet).toLocaleString()}ft</td>`,i+=`<td style="text-align: right;">${String(Math.round(e.windDir)).padStart(3,"0")}°/${Math.round(e.windSpeed)}kt</td>`,i+="</tr>"}),i+="</table>",i+="</div>"}if(n>0&&(i+='<br/><div style="margin-top: 2px; font-size: 11px;">',i+=`${Qt(t.bearing||0)} | ${Kt(t.distance||0)}`,t.groundSpeed&&(i+=` | GS ${Math.round(t.groundSpeed)}kt`),i+="</div>"),r?.condition){const e=fi(r.condition);i+=`<br/><span style="color: ${e}; font-weight: bold; margin-top: 4px; display: inline-block;">Conditions: ${r.condition.toUpperCase()}</span>`,r.conditionReasons&&r.conditionReasons.length>0&&(i+='<br/><span style="font-size: 10px;">',r.conditionReasons.forEach(e=>{i+=`<br/>⚠️ ${e}`}),i+="</span>")}o.bindTooltip(i,{permanent:!1,direction:"top"}),o.on("click",()=>{a(1,g=t.id)}),C?.addLayer(o)}),A.enableLogging&&console.log("[VFR Planner] Created",p.waypoints.length,"waypoint markers"),n.addLayer(C),A.enableLogging&&(console.log("[VFR Planner] Added waypointMarkers layer to map"),console.log("[VFR Planner] Map has",n.getLayers?n.getLayers().length:"unknown","layers"))}function Q(){T&&(T.remove(),T=null),C&&(C.remove(),C=null),R.clear()}function ee(){if(!p||0===p.waypoints.length)return;const e=L.latLngBounds(p.waypoints.map(e=>[e.lat,e.lon]));n.fitBounds(e,{padding:[50,50]})}function te(){try{const e={flightPlan:p?{...p,departureTime:p.departureTime?p.departureTime.getTime():void 0,waypoints:p.waypoints.map(e=>({...e,eta:e.eta?e.eta.getTime():void 0}))}:null,settings:A,departureTime:M,syncWithWindy:N,activeTab:m,maxProfileAltitude:D,profileScale:E,version:"1.0"};localStorage.setItem(d,JSON.stringify(e))}catch(e){console.warn("[VFR Planner] Failed to save session:",e)}}var ne;ne=()=>{o.on(l,H),i.on("timestamp",J)},I().$$.on_mount.push(ne),function(e){I().$$.on_destroy.push(e)}(()=>{Q(),o.off(l,H),i.off("timestamp",J)});return[p,g,f,h,v,u,m,w,b,x,$,z,M,F,N,A,D,E,c,function(e){e.preventDefault(),a(3,h=!0)},function(){a(3,h=!1)},async function(e){e.preventDefault(),a(3,h=!1);const t=e.dataTransfer?.files;t&&t.length>0&&await O(t[0])},async function(e){const t=e.target;t.files&&t.files.length>0&&await O(t.files[0])},W,B,_,G,q,X,function(){a(7,w=!w)},function(){if(!p)return;a(0,p.aircraft.airspeed=A.defaultAirspeed,p),a(0,p.aircraft.defaultAltitude=A.defaultAltitude,p);const e=Jt(p.waypoints,A.defaultAirspeed);a(0,p={...p,waypoints:e.waypoints,totals:e.totals}),K(),te()},function(){p&&function(e){const t=nn(e),n=new Blob([t],{type:"application/gpx+xml"}),o=URL.createObjectURL(n),i=`${e.name.replace(/[^a-zA-Z0-9-_]/g,"_")}.gpx`,s=document.createElement("a");s.href=o,s.download=i,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}(p)},function(){if(!p||0===p.waypoints.length)return;const e=`https://www.windy.com/distance/${p.waypoints.map(e=>`${e.lat.toFixed(4)},${e.lon.toFixed(4)}`).join(";")}`;window.open(e,"_blank","noopener,noreferrer")},function(){if(!p||p.waypoints.length<2)return;const e=[...p.waypoints].reverse();let t=p.name;const n=p.name.match(/^(.+?)\s+to\s+(.+)$/i);if(n)t=`${n[2]} to ${n[1]}`;else if(p.waypoints.length>=2){t=`${e[0].name} to ${e[e.length-1].name}`}const o=Jt(e,A.defaultAirspeed);a(8,b=new Map),y=new Map,a(10,$=null),a(0,p={...p,name:t,waypoints:o.waypoints,totals:o.totals}),a(1,g=null),K(),ee(),te()},Y,Z,function(e){return y.get(e)||[]},function(){return y.size>0},async function(){if(p&&F){if(N&&!P&&!S){S=!0;try{i.set("timestamp",M)}finally{setTimeout(()=>{S=!1},100)}}await Y(),te()}},function(){if(a(14,N=!N),N&&F){const e=i.get("timestamp");e&&setTimeout(()=>{J(e)},50)}else N||(P=!1,S=!1);te()},e=>{!function(){try{const e=localStorage.getItem(d);if(!e)return;const t=JSON.parse(e);if(t.settings&&a(15,A={...Pn,...t.settings}),t.departureTime&&a(12,M=t.departureTime),"boolean"==typeof t.syncWithWindy&&a(14,N=t.syncWithWindy),t.activeTab&&a(6,m=t.activeTab),"number"==typeof t.maxProfileAltitude&&a(16,D=t.maxProfileAltitude),"number"==typeof t.profileScale&&a(17,E=t.profileScale),t.flightPlan){const e={...t.flightPlan,departureTime:t.flightPlan.departureTime?new Date(t.flightPlan.departureTime):void 0,waypoints:t.flightPlan.waypoints.map(e=>({...e,eta:e.eta?new Date(e.eta):void 0}))};a(0,p=e),K(),ee()}}catch(e){console.warn("[VFR Planner] Failed to load session:",e),localStorage.removeItem(d)}}(),p&&K()},()=>t.emit("rqstOpen","menu"),()=>a(6,m="route"),()=>a(6,m="profile"),()=>a(6,m="settings"),function(e){V[e?"unshift":"push"](()=>{u=e,a(5,u)})},()=>u?.click(),function(){M=k(this.value),a(12,M)},(e,t)=>{void 0!==e.cloudBase&&t&&async function(e,t,n,o=!1){try{const r=i.get("product"),a=await s(r,{lat:e,lon:t},{},{}),{data:l}=a.data;if(!l.cbase||!Array.isArray(l.cbase)||0===l.cbase.length)return o&&console.log("[VFR] cbase table:",{waypoint:n||"Unknown",message:"Not available for this location"}),null;const c=l.ts.map((e,t)=>{const n=l.cbase?.[t],o=null!=n&&!isNaN(n)&&n>0;return{timestamp:e,timestampISO:new Date(e).toISOString(),cbase:o?n:null,cbaseFeet:o?cn(n):null}});return o&&console.log("[VFR] Full cbase table:",{waypoint:n||"Unknown",location:{lat:e,lon:t},product:r,totalPoints:c.length,table:c}),c}catch(e){return console.error("Failed to get cbase table:",e),null}}(t.lat,t.lon,t.name,A.enableLogging)},e=>G(e.id),e=>q(e.id),e=>X(e.id),e=>B(e),e=>_(e.detail),function(){A.defaultAirspeed=k(this.value),a(15,A)},function(){A.defaultAltitude=k(this.value),a(15,A)},function(){A.allowDrag=this.checked,a(15,A)},function(){A.showLabels=this.checked,a(15,A)},function(){A.terrainSampleInterval=k(this.value),a(15,A)},function(){D=k(this.value),a(16,D)},function(){A.enableLogging=this.checked,a(15,A)}]}class zi extends le{constructor(e){super(),ae(this,e,$i,gi,p,{onopen:40},Ro,[-1,-1,-1])}get onopen(){return this.$$.ctx[40]}}export{e as __pluginConfig,zi as default};
